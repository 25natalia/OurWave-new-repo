/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t={471:(t,e,n)=>{n.d(e,{A:()=>a});var s=n(601),i=n.n(s),r=n(314),o=n.n(r)()(i());o.push([t.id,".card {\n\tfont-family: 'inter';\n\tbackground-color: rgb(237, 237, 237);\n\twidth: 90%;\n\tpadding: 10px;\n\tborder-radius: 10px;\n\tmargin-left: 20px;\n\tmargin-top: 10px;\n\tmargin-bottom: 10px;\n\tdisplay: flex;\n\talign-items: center;\n\tcolor: rgb(30, 30, 30);\n}\n\n.top {\n\tmargin: 10px;\n\tmargin-right: 20px;\n\tfont-family: 'inter';\n\tfont-weight: 600;\n\tcolor: rgba(30, 30, 30, 0.7);\n}\n\n.artist {\n\tfont-size: 12px;\n\tmargin-top: 2px;\n}\n\n.title {\n\tfont-size: 15px;\n\tfont-weight: 600;\n\tmargin: 0;\n}\n\n.letters {\n\tmargin-left: 10px;\n}\n\nimg {\n\theight: 50px;\n\twidth: 50px;\n\tborder-radius: 5px;\n}\n\n.imagen {\n\tjustify-content: center;\n}\n\np {\n\tmargin-top: 0%;\n\tmargin-bottom: 0%;\n}\n",""]);const a=o},357:(t,e,n)=>{n.d(e,{A:()=>a});var s=n(601),i=n.n(s),r=n(314),o=n.n(r)()(i());o.push([t.id,".image img {\n\twidth: 30px;\n\theight: 30px; /* Ancho del contenedor */ /* Altura del contenedor */\n\toverflow: hidden; /* Oculta cualquier contenido que exceda los límites del contenedor */\n\tborder-radius: 50%;\n\tdisplay: block; /* Asegura que la imagen se comporte como un bloque */\n\tborder-radius: 50%; /* Hace que la imagen sea circular */\n\tmargin: 10px;\n}\n\n.comment,\n.like_group,\n.share {\n\tmargin-left: 15px;\n\tmargin-right: 15px;\n}\n\n.cardEntera {\n\tbackground-color: rgb(255, 255, 255);\n\twidth: 70%;\n\theight: 15%;\n\tpadding: 10px;\n\tmargin-bottom: 10px;\n\tborder-radius: 10px;\n\tbox-shadow: 0 4px 8px rgba(0, 0, 0.3, 0.3);\n\tmargin-left: 15%;\n\tmargin-top: 2%;\n\tfont-family: 'inter';\n}\n\n.profile {\n\tdisplay: flex;\n}\n.interacciones {\n\tdisplay: flex;\n\tcolor: #2ec4b6;\n\talign-items: center;\n\tjustify-content: end;\n}\n.like_group,\n.share,\n.comment {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n#svg {\n\twidth: 26px;\n\theight: 26px;\n\tmargin: 3px;\n}\n\n#svg_like {\n\twidth: 26px;\n\theight: 26px;\n\tmargin: 3px;\n}\n\np {\n\tmargin: 0;\n}\n",""]);const a=o},499:(t,e,n)=>{n.d(e,{A:()=>a});var s=n(601),i=n.n(s),r=n(314),o=n.n(r)()(i());o.push([t.id,"p {\n\tfont-family: 'inter';\n\tfont-size: 14px;\n\tcolor: white;\n}\n.image img {\n\twidth: 30px;\n\theight: 30px; /* Ancho del contenedor */ /* Altura del contenedor */\n\toverflow: hidden; /* Oculta cualquier contenido que exceda los límites del contenedor */\n\tdisplay: block; /* Asegura que la imagen se comporte como un bloque */\n\tborder-radius: 50%; /* Hace que la imagen sea circular */\n\tmargin: 10px;\n}\n\n.image {\n\tdisplay: flex;\n}\n\n.song {\n\tfont-family: 'inter';\n\tfont-weight: 400;\n\tfont-size: 20px;\n\twidth: 280px;\n\talign-items: flex-start;\n\tcolor: white;\n\tmargin-left: 65px;\n\tmargin-top: 0;\n}\n\nh3 {\n\tmargin-top: 0;\n}\n.card {\n\twidth: 400px;\n\theight: 180px;\n\tborder-radius: 20px;\n\tmargin: 20px;\n}\n\n.todo {\n\tposition: relative;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: rgba(0, 0, 0, 0.7);\n\tz-index: 1;\n\tborder-radius: 20px;\n}\n",""]);const a=o},507:(t,e,n)=>{n.d(e,{A:()=>a});var s=n(601),i=n.n(s),r=n(314),o=n.n(r)()(i());o.push([t.id,".header {\n\tbackground-color: rgb(255, 255, 255);\n\theight: 10vh;\n\tbox-shadow: 0 4px 4px rgba(0, 0, 0, 0.1);\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: space-between;\n\talign-items: center;\n}\n\n#perfil {\n\theight: 50px;\n\twidth: 50px;\n\tmargin-right: 2%;\n}\n\n.header img {\n\tmargin-left: 5%;\n}\n\n.logo img {\n\theight: 10vh;\n\tmargin-left: 20px;\n\tcursor: pointer;\n}\n\nsvg {\n\tmargin-right: 20px;\n\tcursor: pointer;\n}\n",""]);const a=o},67:(t,e,n)=>{n.d(e,{A:()=>a});var s=n(601),i=n.n(s),r=n(314),o=n.n(r)()(i());o.push([t.id,".menubar {\n\tdisplay: flex;\n\tjustify-content: space-evenly;\n\tposition: fixed;\n\tbottom: 0;\n\talign-items: center;\n\twidth: 100%;\n\theight: 10vh;\n\tbackground-color: white;\n\tz-index: 2;\n\tbox-shadow: 0 -4px 4px rgba(0, 0, 0, 0.1);\n}\n\n#home,\n#chats,\n#profile {\n\theight: 30px;\n\twidth: 30px;\n\tcursor: pointer;\n}\n\n#explore {\n\theight: 24px;\n\twidth: 34px;\n\tcursor: pointer;\n}\n\n@media screen and (max-width: 768px) {\n\t.menubar {\n\t\tdisplay: flex;\n\t\tjustify-content: space-evenly;\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\talign-items: center;\n\t\twidth: 100%;\n\t\theight: 8vh;\n\t\tbackground-color: white;\n\t\tbox-shadow: 0 -4px 4px rgba(0, 0, 0, 0.1);\n\t}\n}\n",""]);const a=o},831:(t,e,n)=>{n.d(e,{A:()=>a});var s=n(601),i=n.n(s),r=n(314),o=n.n(r)()(i());o.push([t.id,".profile {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tflex-direction: column;\n\tfont-family: 'inter';\n\tmargin-top: 30px;\n}\n\n#ButtonSong {\n\tbackground-color: transparent;\n\tborder: none;\n\tcursor: pointer;\n}\n\n#writtenSong {\n\tpadding: 4%;\n\tmargin-top: 2%;\n\tmargin-bottom: 6%;\n\twidth: 40%;\n\tborder-radius: 30px;\n}\n\n.waveSong {\n\tbackground-color: white;\n\tpadding: 20px;\n\tborder-radius: 40px;\n\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n\twidth: 60%;\n\theight: 40%;\n\toverflow-y: auto;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tposition: relative;\n\tmargin: auto;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n}\n\n.modalContainer {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-family: Arial;\n}\n\n.post {\n\tbackground-color: #2ec4b6;\n\tborder: none;\n\tborder-radius: 50px;\n\tcursor: pointer;\n\theight: 40px;\n\twidth: 120px;\n\ttransition: background-color 0.2s ease;\n\tcolor: white;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\nh2 {\n\tcolor: #ff9f1c;\n\tfont-size: 25px;\n}\n\n.close {\n\tmargin-left: 90%;\n\tmargin-top: 2%;\n\tright: 50px;\n\tcursor: pointer;\n\tfont-family: Arial;\n\tcolor: #2ec4b6;\n}\n\n.image {\n\theight: 200px;\n\tborder-radius: 100px;\n}\n\n.pin {\n\theight: 24px;\n\twidth: 24px;\n}\n\nh1 {\n\tfont-size: 24px;\n\tmargin-bottom: 0;\n\tfont-weight: 700;\n\tcolor: #1e1e1e;\n}\n\n.edit {\n\tbackground-color: transparent;\n\tborder-width: 0;\n\tcolor: #ff9f1c;\n\tcursor: pointer;\n\tfont-family: 'inter';\n\tfont-size: 16px;\n\tmargin-top: 0;\n\tfont-weight: 500;\n}\n\n.fav_song {\n\tdisplay: flex;\n\talign-items: center;\n\tfont-weight: 500;\n\tfont-size: 25px;\n\tcolor: rgb(46, 196, 182);\n\tcursor: pointer;\n}\n\n.name-following {\n\tdisplay: flex;\n\talign-items: center;\n\tflex-direction: row;\n\tjustify-content: center;\n\tfont-family: 'Inter';\n}\n\n.name {\n\tmargin: 5px;\n\tborder: 2px solid rgba(30, 30, 30, 0.2);\n\tborder-radius: 10px;\n\theight: 30px;\n\twidth: 193px;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-size: 16px;\n\tcolor: #1e1e1e;\n}\n\n.following {\n\tmargin: 5px;\n\tborder: 2px solid rgba(30, 30, 30, 0.2);\n\tborder-radius: 10px;\n\theight: 30px;\n\twidth: 193px;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-size: 16px;\n\tcolor: #1e1e1e;\n\tcursor: pointer;\n}\n\n.followers {\n\theight: 55px;\n\twidth: 400px;\n\tbackground-color: #2ec4b6;\n\tfont-weight: 500;\n\tcolor: white;\n\tborder-radius: 12px;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-size: 18px;\n\tmargin: 4px;\n\tbox-shadow: 2px 2px 7px rgba(0, 0, 0, 0.4);\n\tcursor: pointer;\n}\n\n.playlist {\n\theight: 35px;\n\twidth: 400px;\n\tbackground-color: #ff9f1c;\n\tfont-weight: 500;\n\tcolor: white;\n\tborder-radius: 10px;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-size: 15px;\n\tmargin: 4px;\n\tborder: none;\n\tbox-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);\n\tmargin-top: 8px;\n\tcursor: pointer;\n}\n\n.todo {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tfont-family: 'inter';\n}\n\n.playlist:hover {\n\tbackground-color: #ffbf69;\n}\n",""]);const a=o},835:(t,e,n)=>{n.d(e,{A:()=>a});var s=n(601),i=n.n(s),r=n(314),o=n.n(r)()(i());o.push([t.id,"input {\n\twidth: 70vh;\n\tpadding: 10px;\n\tmargin: 2vh;\n\tborder: none;\n\tborder-radius: 12px;\n\tfont-size: 15px;\n\tcolor: rgba(30, 30, 30, 0.8);\n\tbox-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);\n\theight: 4vh;\n}\n\n.info {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-start;\n}\n\nsvg {\n\tmargin-top: 40px;\n\theight: 35px;\n\twidth: 35px;\n\tcursor: pointer;\n\tposition: absolute;\n\tmargin-right: 90%;\n}\n\ninput:focus {\n\tborder-color: #2ec4b6;\n\toutline: none;\n}\n\n.logo {\n\twidth: 40vh;\n}\n\n.todo {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\talign-content: center;\n\tfont-family: 'inter';\n}\n\n.google {\n\twidth: 9vh;\n\tmargin-right: 100px;\n\tbox-shadow: 2px 2px 9px rgba(0, 0, 0, 0.2);\n\tborder-radius: 2vh;\n\tcursor: pointer;\n}\n\n.facebook {\n\twidth: 6vh;\n\tmargin-right: 100px;\n\tbox-shadow: 2px 2px 9px rgba(0, 0, 0, 0.2);\n\tborder-radius: 2vh;\n\tpadding: 8px;\n\tbackground-color: #fdfdfd;\n\tcursor: pointer;\n}\n\n.outlook {\n\twidth: 6vh;\n\tmargin: 10px;\n\tbox-shadow: 2px 2px 9px rgba(0, 0, 0, 0.2);\n\tborder-radius: 2vh;\n\tpadding: 8px;\n\tbackground-color: #fdfdfd;\n\tcursor: pointer;\n}\n\n#apps {\n\tdisplay: flex;\n\talign-items: center;\n}\n\nbutton {\n\twidth: 73vh;\n\tpadding: 10px;\n\tmargin: 2vh;\n\tborder: none;\n\tborder-radius: 10px;\n\tfont-size: 15px;\n\tcolor: white;\n\tbox-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);\n\theight: 6vh;\n\tbackground-color: #2ec4b6;\n\tcursor: pointer;\n\ttransition: 0.3s;\n}\n\nbutton:hover {\n\tbackground-color: #ffbf69;\n}\n\nform {\n\tdisplay: flex;\n\tjustify-content: center;\n\tflex-direction: column;\n}\n\n.text_create {\n\tcolor: rgba(30, 30, 30, 0.6);\n\tmargin-bottom: 25px;\n\tmargin-left: 12px;\n\tmargin-top: 0;\n\tfont-weight: 600;\n}\n\n.text {\n\tcolor: rgba(30, 30, 30, 0.6);\n\tmargin-top: 45px;\n\tmargin-bottom: 45px;\n\tmargin-right: 10px;\n\tfont-weight: 500;\n}\n\n.already_have {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.signup_btn {\n\tcursor: pointer;\n\tcolor: #ff9f1c;\n}\n\n@media screen and (max-width: 768px) {\n\tinput {\n\t\twidth: 50vh;\n\t\tpadding: 10px;\n\t\tmargin: 2vh;\n\t\tborder: none;\n\t\tborder-radius: 12px;\n\t\tfont-size: 15px;\n\t\tcolor: rgba(30, 30, 30, 0.8);\n\t\tbox-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);\n\t\theight: 4vh;\n\t}\n}\n",""]);const a=o},628:(t,e,n)=>{n.d(e,{A:()=>a});var s=n(601),i=n.n(s),r=n(314),o=n.n(r)()(i());o.push([t.id,"h1 {\n\tfont-family: 'inter';\n\tmargin-left: 20px;\n\tfont-size: 30px;\n\tmargin-top: 60px;\n\tcolor: #1e1e1e;\n}\n\n.playlists {\n\tdisplay: flex;\n\toverflow-x: auto;\n\tmax-width: 100%;\n\tpadding-bottom: 20px;\n}\n\n.my-friend {\n\tflex: 0 0 auto;\n\tmargin-right: 20px;\n}\n",""]);const a=o},11:(t,e,n)=>{n.d(e,{A:()=>a});var s=n(601),i=n.n(s),r=n(314),o=n.n(r)()(i());o.push([t.id,".h1Add {\n\tfont-size: 24px;\n\tmargin-bottom: 15px;\n\tcolor: #1e1e1e;\n\tfont-weight: 700;\n\tfont-family: 'Inter';\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tposition: relative;\n\tz-index: 2;\n\tmargin-top: 30px;\n}\n\n.artist,\n.title,\n.image {\n\twidth: 20%;\n\tpadding: 10px;\n\tmargin: 4px;\n\tborder: 2px solid #ccc;\n\tborder-radius: 10px;\n\tfont-size: 15px;\n\tposition: relative;\n\tz-index: 2;\n}\n\n.create-song {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.artist:focus,\n.title:focus,\n.image:focus {\n\tborder-color: #ff9f1c;\n\toutline: none;\n}\n\n.save {\n\tpadding: 10px 65px;\n\tfont-size: 16px;\n\tborder: none;\n\tborder-radius: 5px;\n\tbackground-color: #ff9f1c;\n\tcolor: white;\n\tcursor: pointer;\n\ttransition: 0.3s;\n\tmargin-left: 45%;\n\tmargin-top: 20px;\n\tmargin-bottom: 20px;\n}\n.save:hover {\n\tbackground-color: #ffbf69;\n}\n",""]);const a=o},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",s=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),s&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),s&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,s,i,r){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var l=0;l<t.length;l++){var h=[].concat(t[l]);s&&o[h[0]]||(void 0!==r&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=r),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),i&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=i):h[4]="".concat(i)),e.push(h))}},e}},601:t=>{t.exports=function(t){return t[1]}}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var r=e[s]={id:s,exports:{}};return t[s](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=[{id:1,iconohome:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 576 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#ff9f1c" d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg>',iconoexplore:'"https://i.pinimg.com/originals/94/67/f5/9467f504e83345d60816f9b87ac84588.jpg"',iconoprofile:'<svg xmlns="http://www.w3.org/2000/svg" width="27" height="27" viewBox="0 0 24 24" style="fill: rgb(32, 32, 32);transform: ;msFilter:;"><path d="M12 2C6.579 2 2 6.579 2 12s4.579 10 10 10 10-4.579 10-10S17.421 2 12 2zm0 5c1.727 0 3 1.272 3 3s-1.273 3-3 3c-1.726 0-3-1.272-3-3s1.274-3 3-3zm-5.106 9.772c.897-1.32 2.393-2.2 4.106-2.2h2c1.714 0 3.209.88 4.106 2.2C15.828 18.14 14.015 19 12 19s-3.828-.86-5.106-2.228z"></path></svg>'}];var e,s=n(67);!function(t){t.STORE="STORE"}(e||(e={}));let i=(({key:t,defaultValue:e})=>{const n=localStorage.getItem(t)||sessionStorage.getItem(t);return n?JSON.parse(n):e})({key:e.STORE,defaultValue:{screen:"REGISTER"}}),r=[];const o=t=>{const n=((t,e)=>{const{action:n,payload:s}=t;return"navigate"===n&&(e.screen=s),e})(t,JSON.parse(JSON.stringify(i)));var s;i=n,s=n,(({key:t,value:e,session:n=!1})=>{const s=n?sessionStorage:localStorage,i=JSON.stringify(e);s.setItem(t,i)})({key:e.STORE,value:s,session:!1}),r.forEach((t=>t.render()))},a=t=>{r=[...r,t]},c=t=>({action:"navigate",payload:t});var l;!function(t){t.uid="uid",t.iconohome="iconohome",t.iconoexplore="iconoexplore",t.iconoprofile="iconoprofile"}(l||(l={}));class h extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({uid:null,iconohome:null,iconoexplore:null,iconoprofile:null})}attributeChangedCallback(t,e,n){t===l.uid?this.uid=n?Number(n):void 0:this[t]=n}connectedCallback(){this.render()}render(){var t,e,n,i;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n\t\t\t<section class="menubar">\n\t\t<svg id="home">${this.iconohome}</svg>\n\t\t<img id="explore" src=${this.iconoexplore}></svg>\n\t\t<svg id="profile">${this.iconoprofile}</svg>\n\t\t\t</section>`);const r=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("#home");null==r||r.addEventListener("click",(()=>{o(c("HOME"))}));const a=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("#explore");null==a||a.addEventListener("click",(()=>{o(c("EXPLORE"))}));const l=null===(n=this.shadowRoot)||void 0===n?void 0:n.querySelector("#profile");null==l||l.addEventListener("click",(()=>{o(c("PROFILE"))}));const h=this.ownerDocument.createElement("style");h.innerHTML=s.A,null===(i=this.shadowRoot)||void 0===i||i.appendChild(h)}}customElements.define("my-iconos",h);const u=[{id:1,logo:"https://i.pinimg.com/736x/4e/97/d6/4e97d610dfc03d8fde6969d5be6434f4.jpg"}];var d,f=n(507);!function(t){t.uid="uid",t.logo="logo"}(d||(d={}));class p extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({uid:null,logo:null})}attributeChangedCallback(t,e,n){t===d.uid?this.uid=n?Number(n):void 0:this[t]=n}connectedCallback(){this.render()}render(){var t,e;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n    <section class="header">\n\t\t<section class="logo">\n    <img src='${this.logo}'></img>\n\t\t</section>\n    </section>`);const n=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".logo");null==n||n.addEventListener("click",(()=>{o(c("HOME"))}));const s=this.ownerDocument.createElement("style");s.innerHTML=f.A,null===(e=this.shadowRoot)||void 0===e||e.appendChild(s)}}customElements.define("my-header",p);const g=[{id:1,name:"Sofía García",image:"https://images.pexels.com/photos/3646160/pexels-photo-3646160.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",unlike:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#2ec6b6" d="M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"/></svg>',like:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#2ec6bc" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>',cantidadlike:"6,4k",share:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#2ec6b6" d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480V396.4c0-4 1.5-7.8 4.2-10.7L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>',cantidadshare:"49k",comentar:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#2ec6b6" d="M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4l0 0 0 0 0 0 0 0 .3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z"/></svg>',cantidadcomentar:"6,9k"}];var m,y=n(357);!function(t){t.unlike="unlike",t.like="like",t.cantidadlike="cantidadlike",t.share="share",t.cantidadshare="cantidadshare",t.comentar="comentar",t.cantidadcomentar="cantidadcomentar",t.profileuid="profileuid",t.name="name",t.image="image",t.wave="wave"}(m||(m={}));class v extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({unlike:null,like:null,cantidadlike:null,share:null,cantidadshare:null,comentar:null,cantidadcomentar:null,profileuid:null,name:null,image:null,wave:null})}attributeChangedCallback(t,e,n){t===m.profileuid?this.profileuid=n?Number(n):void 0:this[t]=n}connectedCallback(){this.render(),this.restoreSavedWaves(),this.attachEventHandlers()}attachEventHandlers(){var t,e;const n=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".like"),s=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".unlike");n&&s&&(n.addEventListener("click",(()=>{n.style.display="none",s.style.display="block"})),s.addEventListener("click",(()=>{n.style.display="block",s.style.display="none"})))}render(){var t;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n\t\t\t<section class= "cardEntera">\n\t\t\t<section class= profile>\n\t\t\t<section class="image">\n\t\t\t<img src="${this.image}"></img>\n\t\t\t</section>\n\t\t\t<p>${this.name||"No Username"}</p>\n\t\t\t</section>\n\n<section class="wave">\n\t\t\t</section>\n\n\t\t\t<section class="interacciones">\n\n\t\t\t<section class="like_group">\n\t\t\t<svg id="svg" class="unlike">${this.unlike}</svg>\n\t\t\t<svg id="svg_like" class="like" style="display: none;">${this.like}</svg>\n\t\t\t<p>${this.cantidadlike}</p>\n\t\t\t</section>\n\n\t\t\t<sections class='share'>\n\t\t\t<svg id="svg">${this.share}</svg>\n\t\t\t<p>${this.cantidadshare}</p>\n\t\t\t</sections>\n\n\t\t\t<section class='comment'>\n\t\t\t<svg id="svg">${this.comentar}</svg>\n\t\t\t<p>${this.cantidadcomentar}</p>\n\t\t\t</section>\n\t\t\t</section>\n\t\t\t</section>`);const e=this.ownerDocument.createElement("style");e.innerHTML=y.A,null===(t=this.shadowRoot)||void 0===t||t.appendChild(e)}restoreSavedWaves(){var t;const e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".wave");JSON.parse(localStorage.getItem("savedWaves")||"[]").forEach((t=>{const n=document.createElement("p");n.textContent=t,null==e||e.appendChild(n)}))}}customElements.define("my-card",v);const w=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++s)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},b={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let e=0;e<t.length;e+=3){const i=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,l=i>>2,h=(3&i)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(u=64)),s.push(n[l],n[h],n[u],n[d])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(w(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,s=0;for(;n<t.length;){const i=t[n++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[n++];e[s++]=String.fromCharCode((31&i)<<6|63&r)}else if(i>239&&i<365){const r=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[s++]=String.fromCharCode(55296+(r>>10)),e[s++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[s++]=String.fromCharCode((15&i)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],r=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==r||null==o||null==a)throw new E;const c=i<<2|r>>4;if(s.push(c),64!==o){const t=r<<4&240|o>>2;if(s.push(t),64!==a){const t=o<<6&192|a;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class E extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const _=function(t){return function(t){const e=w(t);return b.encodeByteArray(e,!0)}(t).replace(/\./g,"")},T=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return b.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},S=()=>{var t;return null===(t=T())||void 0===t?void 0:t.config};class C{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function x(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){try{return"object"==typeof indexedDB}catch(t){return!1}}class A extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,A.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,k.prototype.create)}}class k{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],r=i?function(t,e){return t.replace(D,((t,n)=>{const s=e[n];return null!=s?String(s):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${r} (${s}).`;return new A(s,o,n)}}const D=/\{\$([^}]+)}/g;function N(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const n=t[i],r=e[i];if(L(n)&&L(r)){if(!N(n,r))return!1}else if(n!==r)return!1}for(const t of s)if(!n.includes(t))return!1;return!0}function L(t){return null!==t&&"object"==typeof t}function R(t){return t&&t._delegate?t._delegate:t}class O{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const M="[DEFAULT]";class P{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new C;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),s=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(s)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:M})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=M){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=M){return this.instances.has(t)}getOptions(t=M){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(s);return s}onInit(t,e){var n;const s=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&t(r,s),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===M?void 0:s),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var s;return n||null}normalizeInstanceIdentifier(t=M){return this.component?this.component.multipleInstances?t:M:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class F{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new P(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const V=[];var U;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(U||(U={}));const B={debug:U.DEBUG,verbose:U.VERBOSE,info:U.INFO,warn:U.WARN,error:U.ERROR,silent:U.SILENT},j=U.INFO,q={[U.DEBUG]:"log",[U.VERBOSE]:"log",[U.INFO]:"info",[U.WARN]:"warn",[U.ERROR]:"error"},$=(t,e,...n)=>{if(e<t.logLevel)return;const s=(new Date).toISOString(),i=q[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${s}]  ${t.name}:`,...n)};class z{constructor(t){this.name=t,this._logLevel=j,this._logHandler=$,this._userLogHandler=null,V.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in U))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?B[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,U.DEBUG,...t),this._logHandler(this,U.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,U.VERBOSE,...t),this._logHandler(this,U.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,U.INFO,...t),this._logHandler(this,U.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,U.WARN,...t),this._logHandler(this,U.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,U.ERROR,...t),this._logHandler(this,U.ERROR,...t)}}const H=(t,e)=>e.some((e=>t instanceof e));let K,G;const Q=new WeakMap,W=new WeakMap,X=new WeakMap,Y=new WeakMap,J=new WeakMap;let Z={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return W.get(t);if("objectStoreNames"===e)return t.objectStoreNames||X.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return et(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function tt(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(G||(G=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(nt(this),t),et(Q.get(this))}:function(...t){return et(e.apply(nt(this),t))}:function(t,...n){const s=e.call(nt(this),t,...n);return X.set(s,t.sort?t.sort():[t]),et(s)}:(t instanceof IDBTransaction&&function(t){if(W.has(t))return;const e=new Promise(((e,n)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",r),t.removeEventListener("abort",r)},i=()=>{e(),s()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",r),t.addEventListener("abort",r)}));W.set(t,e)}(t),H(t,K||(K=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Z):t);var e}function et(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",r)},i=()=>{e(et(t.result)),s()},r=()=>{n(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&Q.set(e,t)})).catch((()=>{})),J.set(e,t),e}(t);if(Y.has(t))return Y.get(t);const e=tt(t);return e!==t&&(Y.set(t,e),J.set(e,t)),e}const nt=t=>J.get(t),st=["get","getKey","getAll","getAllKeys","count"],it=["put","add","delete","clear"],rt=new Map;function ot(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(rt.get(e))return rt.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=it.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!i&&!st.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,i?"readwrite":"readonly");let o=r.store;return s&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&r.done]))[0]};return rt.set(e,r),r}var at;at=Z,Z={...at,get:(t,e,n)=>ot(t,e)||at.get(t,e,n),has:(t,e)=>!!ot(t,e)||at.has(t,e)};class ct{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const lt="@firebase/app",ht="0.9.26",ut=new z("@firebase/app"),dt="[DEFAULT]",ft={[lt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},pt=new Map,gt=new Map;function mt(t,e){try{t.container.addComponent(e)}catch(n){ut.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function yt(t){const e=t.name;if(gt.has(e))return ut.debug(`There were multiple attempts to register component ${e}.`),!1;gt.set(e,t);for(const e of pt.values())mt(e,t);return!0}const vt=new k("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class wt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new O("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw vt.create("app-deleted",{appName:this._name})}}function bt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const s=Object.assign({name:dt,automaticDataCollectionEnabled:!1},e),i=s.name;if("string"!=typeof i||!i)throw vt.create("bad-app-name",{appName:String(i)});if(n||(n=S()),!n)throw vt.create("no-options");const r=pt.get(i);if(r){if(N(n,r.options)&&N(s,r.config))return r;throw vt.create("duplicate-app",{appName:i})}const o=new F(i);for(const t of gt.values())o.addComponent(t);const a=new wt(n,s,o);return pt.set(i,a),a}function Et(t,e,n){var s;let i=null!==(s=ft[t])&&void 0!==s?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${i}" with version "${e}":`];return r&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void ut.warn(t.join(" "))}yt(new O(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const _t="firebase-heartbeat-database",Tt=1,St="firebase-heartbeat-store";let Ct=null;function xt(){return Ct||(Ct=function(t,e,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),a=et(o);return s&&o.addEventListener("upgradeneeded",(t=>{s(et(o.result),t.oldVersion,t.newVersion,et(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(_t,Tt,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(St)}catch(t){console.warn(t)}}}).catch((t=>{throw vt.create("idb-open",{originalErrorMessage:t.message})}))),Ct}async function It(t,e){try{const n=(await xt()).transaction(St,"readwrite"),s=n.objectStore(St);await s.put(e,At(t)),await n.done}catch(t){if(t instanceof A)ut.warn(t.message);else{const e=vt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});ut.warn(e.message)}}}function At(t){return`${t.name}!${t.options.appId}`}class kt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Nt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Dt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==s&&!this._heartbeatsCache.heartbeats.some((t=>t.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Dt(),{heartbeatsToSend:n,unsentEntries:s}=function(t,e=1024){const n=[];let s=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),Lt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Lt(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),i=_(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Dt(){return(new Date).toISOString().substring(0,10)}class Nt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!I()&&new Promise(((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await xt();return await e.transaction(St).objectStore(St).get(At(t))}catch(t){if(t instanceof A)ut.warn(t.message);else{const e=vt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});ut.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return It(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return It(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Lt(t){return _(JSON.stringify({version:2,heartbeats:t})).length}yt(new O("platform-logger",(t=>new ct(t)),"PRIVATE")),yt(new O("heartbeat",(t=>new kt(t)),"PRIVATE")),Et(lt,ht,""),Et(lt,ht,"esm2017"),Et("fire-js",""),Et("firebase","10.7.2","app");var Rt,Ot="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Mt={},Pt=Pt||{},Ft=Ot||self;function Vt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Ut(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Bt="closure_uid_"+(1e9*Math.random()>>>0),jt=0;function qt(t,e,n){return t.call.apply(t.bind,arguments)}function $t(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function zt(t,e,n){return(zt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?qt:$t).apply(null,arguments)}function Ht(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Kt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return e.prototype[n].apply(t,i)}}function Gt(){this.s=this.s,this.o=this.o}Gt.prototype.s=!1,Gt.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Bt)&&t[Bt]||(t[Bt]=++jt))},Gt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Qt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Wt(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function Xt(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(Vt(n)){const e=t.length||0,s=n.length||0;t.length=e+s;for(let i=0;i<s;i++)t[e+i]=n[i]}else t.push(n)}}function Yt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Yt.prototype.h=function(){this.defaultPrevented=!0};var Jt=function(){if(!Ft.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};Ft.addEventListener("test",t,e),Ft.removeEventListener("test",t,e)}catch(t){}return t}();function Zt(t){return/^[\s\xa0]*$/.test(t)}function te(){var t=Ft.navigator;return t&&(t=t.userAgent)?t:""}function ee(t){return-1!=te().indexOf(t)}function ne(t){return ne[" "](t),t}ne[" "]=function(){};var se,ie,re,oe=ee("Opera"),ae=ee("Trident")||ee("MSIE"),ce=ee("Edge"),le=ce||ae,he=ee("Gecko")&&!(-1!=te().toLowerCase().indexOf("webkit")&&!ee("Edge"))&&!(ee("Trident")||ee("MSIE"))&&!ee("Edge"),ue=-1!=te().toLowerCase().indexOf("webkit")&&!ee("Edge");function de(){var t=Ft.document;return t?t.documentMode:void 0}t:{var fe="",pe=(ie=te(),he?/rv:([^\);]+)(\)|;)/.exec(ie):ce?/Edge\/([\d\.]+)/.exec(ie):ae?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ie):ue?/WebKit\/(\S+)/.exec(ie):oe?/(?:Version)[ \/]?(\S+)/.exec(ie):void 0);if(pe&&(fe=pe?pe[1]:""),ae){var ge=de();if(null!=ge&&ge>parseFloat(fe)){se=String(ge);break t}}se=fe}Ft.document&&ae?re=de()||parseInt(se,10)||void 0:re=void 0;var me=re;function ye(t,e){if(Yt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(he){t:{try{ne(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ve[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&ye.$.h.call(this)}}Kt(ye,Yt);var ve={2:"touch",3:"pen",4:"mouse"};ye.prototype.h=function(){ye.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var we="closure_listenable_"+(1e6*Math.random()|0),be=0;function Ee(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.la=i,this.key=++be,this.fa=this.ia=!1}function _e(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Te(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function Se(t){const e={};for(const n in t)e[n]=t[n];return e}const Ce="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xe(t,e){let n,s;for(let e=1;e<arguments.length;e++){for(n in s=arguments[e],s)t[n]=s[n];for(let e=0;e<Ce.length;e++)n=Ce[e],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Ie(t){this.src=t,this.g={},this.h=0}function Ae(t,e){var n=e.type;if(n in t.g){var s,i=t.g[n],r=Qt(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(_e(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function ke(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.fa&&r.listener==e&&r.capture==!!n&&r.la==s)return i}return-1}Ie.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=ke(t,e,s,i);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new Ee(e,this.src,r,!!s,i)).ia=n,t.push(e)),e};var De="closure_lm_"+(1e6*Math.random()|0),Ne={};function Le(t,e,n,s,i){if(s&&s.once)return Oe(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)Le(t,e[r],n,s,i);return null}return n=je(n),t&&t[we]?t.O(e,n,Ut(s)?!!s.capture:!!s,i):Re(t,e,n,!1,s,i)}function Re(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=Ut(i)?!!i.capture:!!i,a=Ue(t);if(a||(t[De]=a=new Ie(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){const t=Ve;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)Jt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(Fe(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function Oe(t,e,n,s,i){if(Array.isArray(e)){for(var r=0;r<e.length;r++)Oe(t,e[r],n,s,i);return null}return n=je(n),t&&t[we]?t.P(e,n,Ut(s)?!!s.capture:!!s,i):Re(t,e,n,!0,s,i)}function Me(t,e,n,s,i){if(Array.isArray(e))for(var r=0;r<e.length;r++)Me(t,e[r],n,s,i);else s=Ut(s)?!!s.capture:!!s,n=je(n),t&&t[we]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=ke(r=t.g[e],n,s,i))&&(_e(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=Ue(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ke(e,n,s,i)),(n=-1<t?e[t]:null)&&Pe(n))}function Pe(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[we])Ae(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Fe(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Ue(e))?(Ae(n,t),0==n.h&&(n.src=null,e[De]=null)):_e(t)}}}function Fe(t){return t in Ne?Ne[t]:Ne[t]="on"+t}function Ve(t,e){if(t.fa)t=!0;else{e=new ye(e,this);var n=t.listener,s=t.la||t.src;t.ia&&Pe(t),t=n.call(s,e)}return t}function Ue(t){return(t=t[De])instanceof Ie?t:null}var Be="__closure_events_fn_"+(1e9*Math.random()>>>0);function je(t){return"function"==typeof t?t:(t[Be]||(t[Be]=function(e){return t.handleEvent(e)}),t[Be])}function qe(){Gt.call(this),this.i=new Ie(this),this.S=this,this.J=null}function $e(t,e){var n,s=t.J;if(s)for(n=[];s;s=s.J)n.push(s);if(t=t.S,s=e.type||e,"string"==typeof e)e=new Yt(e,t);else if(e instanceof Yt)e.target=e.target||t;else{var i=e;xe(e=new Yt(s,t),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];i=ze(o,s,!0,e)&&i}if(i=ze(o=e.g=t,s,!0,e)&&i,i=ze(o,s,!1,e)&&i,n)for(r=0;r<n.length;r++)i=ze(o=e.g=n[r],s,!1,e)&&i}function ze(t,e,n,s){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Ae(t.i,o),i=!1!==a.call(c,s)&&i}}return i&&!s.defaultPrevented}Kt(qe,Gt),qe.prototype[we]=!0,qe.prototype.removeEventListener=function(t,e,n,s){Me(this,t,e,n,s)},qe.prototype.N=function(){if(qe.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],s=0;s<n.length;s++)_e(n[s]);delete e.g[t],e.h--}}this.J=null},qe.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)},qe.prototype.P=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};var He=Ft.JSON.stringify;function Ke(){var t=Ze;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ge=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Qe),(t=>t.reset()));class Qe{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function We(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Xe(t){Ft.setTimeout((()=>{throw t}),0)}let Ye,Je=!1,Ze=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ge.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},tn=()=>{const t=Ft.Promise.resolve(void 0);Ye=()=>{t.then(en)}};var en=()=>{for(var t;t=Ke();){try{t.h.call(t.g)}catch(t){Xe(t)}var e=Ge;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Je=!1};function nn(t,e){qe.call(this),this.h=t||1,this.g=e||Ft,this.j=zt(this.qb,this),this.l=Date.now()}function sn(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function rn(t,e,n){if("function"==typeof t)n&&(t=zt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=zt(t.handleEvent,t)}return 2147483647<Number(e)?-1:Ft.setTimeout(t,e||0)}function on(t){t.g=rn((()=>{t.g=null,t.i&&(t.i=!1,on(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Kt(nn,qe),(Rt=nn.prototype).ga=!1,Rt.T=null,Rt.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),$e(this,"tick"),this.ga&&(sn(this),this.start()))}},Rt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Rt.N=function(){nn.$.N.call(this),sn(this),delete this.g};class an extends Gt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:on(this)}N(){super.N(),this.g&&(Ft.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function cn(t){Gt.call(this),this.h=t,this.g={}}Kt(cn,Gt);var ln=[];function hn(t,e,n,s){Array.isArray(n)||(n&&(ln[0]=n.toString()),n=ln);for(var i=0;i<n.length;i++){var r=Le(e,n[i],s||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function un(t){Te(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Pe(t)}),t),t.g={}}function dn(){this.g=!0}function fn(t,e,n,s){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return He(n)}catch(t){return e}}(t,n)+(s?" "+s:"")}))}cn.prototype.N=function(){cn.$.N.call(this),un(this)},cn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},dn.prototype.Ea=function(){this.g=!1},dn.prototype.info=function(){};var pn={},gn=null;function mn(){return gn=gn||new qe}function yn(t){Yt.call(this,pn.Ta,t)}function vn(t){const e=mn();$e(e,new yn(e))}function wn(t,e){Yt.call(this,pn.STAT_EVENT,t),this.stat=e}function bn(t){const e=mn();$e(e,new wn(e,t))}function En(t,e){Yt.call(this,pn.Ua,t),this.size=e}function _n(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return Ft.setTimeout((function(){t()}),e)}pn.Ta="serverreachability",Kt(yn,Yt),pn.STAT_EVENT="statevent",Kt(wn,Yt),pn.Ua="timingevent",Kt(En,Yt);var Tn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Sn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Cn(){}function xn(t){return t.h||(t.h=t.i())}function In(){}Cn.prototype.h=null;var An,kn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Dn(){Yt.call(this,"d")}function Nn(){Yt.call(this,"c")}function Ln(){}function Rn(t,e,n,s){this.l=t,this.j=e,this.m=n,this.W=s||1,this.U=new cn(this),this.P=Mn,t=le?125:void 0,this.V=new nn(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new On}function On(){this.i=null,this.g="",this.h=!1}Kt(Dn,Yt),Kt(Nn,Yt),Kt(Ln,Cn),Ln.prototype.g=function(){return new XMLHttpRequest},Ln.prototype.i=function(){return{}},An=new Ln;var Mn=45e3,Pn={},Fn={};function Vn(t,e,n){t.L=1,t.A=ss(Jn(e)),t.u=n,t.S=!0,Un(t,null)}function Un(t,e){t.G=Date.now(),$n(t),t.B=Jn(t.A);var n=t.B,s=t.W;Array.isArray(s)||(s=[String(s)]),ms(n.i,"t",s),t.o=0,n=t.l.J,t.h=new On,t.g=mi(t.l,n?e:null,!t.u),0<t.O&&(t.M=new an(zt(t.Pa,t,t.g),t.O)),hn(t.U,t.g,"readystatechange",t.nb),e=t.I?Se(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),vn(),function(t,e,n,s,i,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var h=l[0];l=l[1];var u=h.split("_");o=2<=u.length&&"type"==u[1]?o+(h+"=")+l+"&":o+(h+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function Bn(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function jn(t,e,n){let s,i=!0;for(;!t.J&&t.o<n.length;){if(s=qn(t,n),s==Fn){4==e&&(t.s=4,bn(14),i=!1),fn(t.j,t.m,null,"[Incomplete Response]");break}if(s==Pn){t.s=4,bn(15),fn(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}fn(t.j,t.m,s,null),Qn(t,s)}Bn(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,bn(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),ci(e),e.M=!0,bn(11))):(fn(t.j,t.m,n,"[Invalid Chunked Response]"),Gn(t),Kn(t))}function qn(t,e){var n=t.o,s=e.indexOf("\n",n);return-1==s?Fn:(n=Number(e.substring(n,s)),isNaN(n)?Pn:(s+=1)+n>e.length?Fn:(e=e.slice(s,s+n),t.o=s+n,e))}function $n(t){t.Y=Date.now()+t.P,zn(t,t.P)}function zn(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=_n(zt(t.lb,t),e)}function Hn(t){t.C&&(Ft.clearTimeout(t.C),t.C=null)}function Kn(t){0==t.l.H||t.J||ui(t.l,t)}function Gn(t){Hn(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,sn(t.V),un(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Qn(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Ts(n.i,t)))if(!t.K&&Ts(n.i,t)&&3==n.H){try{var s=n.Ja.g.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;hi(n),ti(n)}ai(n),bn(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=_n(zt(n.ib,n),6e3));if(1>=_s(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else fi(n,11)}else if((t.K||n.g==t)&&hi(n),!Zt(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let l=i[e];if(n.V=l[0],l=l[1],2==n.H)if("c"==l[0]){n.K=l[1],n.pa=l[2];const e=l[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const i=l[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const h=l[5];null!=h&&"number"==typeof h&&0<h&&(s=1.5*h,n.L=s,n.l.info("backChannelRequestTimeoutMs_="+s)),s=n;const u=t.g;if(u){const t=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=s.i;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(Ss(r,r.h),r.h=null))}if(s.F){const t=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(s.Da=t,ns(s.I,s.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((s=n).wa=gi(s,s.J?s.pa:null,s.Y),o.K){Cs(s.i,o);var a=o,c=s.L;c&&a.setTimeout(c),a.C&&(Hn(a),$n(a)),s.g=o}else oi(s);0<n.j.length&&ni(n)}else"stop"!=l[0]&&"close"!=l[0]||fi(n,7);else 3==n.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?fi(n,7):Zs(n):"noop"!=l[0]&&n.h&&n.h.Aa(l),n.A=0)}vn()}catch(t){}}function Wn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Vt(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(Vt(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const s in t)e[n++]=s;return e}}}(t),s=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(Vt(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t),i=s.length,r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}(Rt=Rn.prototype).setTimeout=function(t){this.P=t},Rt.nb=function(t){t=t.target;const e=this.M;e&&3==Gs(t)?e.l():this.Pa(t)},Rt.Pa=function(t){try{if(t==this.g)t:{const h=Gs(this.g);var e=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||le||this.g&&(this.h.h||this.g.ja()||Qs(this.g)))){this.J||4!=h||7==e||vn(),Hn(this);var n=this.g.da();this.ca=n;e:if(Bn(this)){var s=Qs(this.g);t="";var i=s.length,r=4==Gs(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Gn(this),Kn(this);var o="";break e}this.h.i=new Ft.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:r&&e==i-1});s.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,s,i,r,o){t.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.v,this.B,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Zt(a)){var l=a;break e}}l=null}if(!(n=l)){this.i=!1,this.s=3,bn(12),Gn(this),Kn(this);break t}fn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qn(this,n)}this.S?(jn(this,h,o),le&&this.i&&3==h&&(hn(this.U,this.V,"tick",this.mb),this.V.start())):(fn(this.j,this.m,o,null),Qn(this,o)),4==h&&Gn(this),this.i&&!this.J&&(4==h?ui(this.l,this):(this.i=!1,$n(this)))}else(function(t){const e={};t=(t.g&&2<=Gs(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<t.length;s++){if(Zt(t[s]))continue;var n=We(t[s]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const r=e[i]||[];e[i]=r,r.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,bn(12)):(this.s=0,bn(13)),Gn(this),Kn(this)}}}catch(t){}},Rt.mb=function(){if(this.g){var t=Gs(this.g),e=this.g.ja();this.o<e.length&&(Hn(this),jn(this,t,e),this.i&&4!=t&&$n(this))}},Rt.cancel=function(){this.J=!0,Gn(this)},Rt.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(vn(),bn(17)),Gn(this),this.s=2,Kn(this)):zn(this,this.Y-t)};var Xn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Yn(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Yn){this.h=t.h,Zn(this,t.j),this.s=t.s,this.g=t.g,ts(this,t.m),this.l=t.l;var e=t.i,n=new ds;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),es(this,n),this.o=t.o}else t&&(e=String(t).match(Xn))?(this.h=!1,Zn(this,e[1]||"",!0),this.s=is(e[2]||""),this.g=is(e[3]||"",!0),ts(this,e[4]),this.l=is(e[5]||"",!0),es(this,e[6]||"",!0),this.o=is(e[7]||"")):(this.h=!1,this.i=new ds(null,this.h))}function Jn(t){return new Yn(t)}function Zn(t,e,n){t.j=n?is(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ts(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function es(t,e,n){e instanceof ds?(t.i=e,function(t,e){e&&!t.j&&(fs(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(ps(this,e),ms(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=rs(e,hs)),t.i=new ds(e,t.h))}function ns(t,e,n){t.i.set(e,n)}function ss(t){return ns(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function is(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function rs(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,os),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function os(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Yn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(rs(e,as,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(rs(e,as,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(rs(n,"/"==n.charAt(0)?ls:cs,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",rs(n,us)),t.join("")};var as=/[#\/\?@]/g,cs=/[#\?:]/g,ls=/[#\?]/g,hs=/[#\?@]/g,us=/#/g;function ds(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function fs(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function ps(t,e){fs(t),e=ys(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function gs(t,e){return fs(t),e=ys(t,e),t.g.has(e)}function ms(t,e,n){ps(t,e),0<n.length&&(t.i=null,t.g.set(ys(t,e),Wt(n)),t.h+=n.length)}function ys(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(Rt=ds.prototype).add=function(t,e){fs(this),this.i=null,t=ys(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},Rt.forEach=function(t,e){fs(this),this.g.forEach((function(n,s){n.forEach((function(n){t.call(e,n,s,this)}),this)}),this)},Rt.ta=function(){fs(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let s=0;s<e.length;s++){const i=t[s];for(let t=0;t<i.length;t++)n.push(e[s])}return n},Rt.Z=function(t){fs(this);let e=[];if("string"==typeof t)gs(this,t)&&(e=e.concat(this.g.get(ys(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},Rt.set=function(t,e){return fs(this),this.i=null,gs(this,t=ys(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},Rt.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},Rt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var s=e[n];const r=encodeURIComponent(String(s)),o=this.Z(s);for(s=0;s<o.length;s++){var i=r;""!==o[s]&&(i+="="+encodeURIComponent(String(o[s]))),t.push(i)}}return this.i=t.join("&")};var vs=class{constructor(t,e){this.g=t,this.map=e}};function ws(t){this.l=t||bs,t=Ft.PerformanceNavigationTiming?0<(t=Ft.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Ft.g&&Ft.g.Ka&&Ft.g.Ka()&&Ft.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var bs=10;function Es(t){return!!t.h||!!t.g&&t.g.size>=t.j}function _s(t){return t.h?1:t.g?t.g.size:0}function Ts(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Ss(t,e){t.g?t.g.add(e):t.h=e}function Cs(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function xs(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Wt(t.i)}ws.prototype.cancel=function(){if(this.i=xs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Is=class{stringify(t){return Ft.JSON.stringify(t,void 0)}parse(t){return Ft.JSON.parse(t,void 0)}};function As(){this.g=new Is}function ks(t,e,n){const s=n||"";try{Wn(t,(function(t,n){let i=t;Ut(t)&&(i=He(t)),e.push(s+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function Ds(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}function Ns(t){this.l=t.ec||null,this.j=t.ob||!1}function Ls(t,e){qe.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=Rs,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Kt(Ns,Cn),Ns.prototype.g=function(){return new Ls(this.l,this.j)},Ns.prototype.i=function(t){return function(){return t}}({}),Kt(Ls,qe);var Rs=0;function Os(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function Ms(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Ps(t)}function Ps(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(Rt=Ls.prototype).open=function(t,e){if(this.readyState!=Rs)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Ps(this)},Rt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||Ft).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},Rt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ms(this)),this.readyState=Rs},Rt.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ps(this)),this.g&&(this.readyState=3,Ps(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Ft.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Os(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},Rt.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ms(this):Ps(this),3==this.readyState&&Os(this)}},Rt.Za=function(t){this.g&&(this.response=this.responseText=t,Ms(this))},Rt.Ya=function(t){this.g&&(this.response=t,Ms(this))},Rt.ka=function(){this.g&&Ms(this)},Rt.setRequestHeader=function(t,e){this.v.append(t,e)},Rt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},Rt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Ls.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Fs=Ft.JSON.parse;function Vs(t){qe.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Us,this.L=this.M=!1}Kt(Vs,qe);var Us="",Bs=/^https?$/i,js=["POST","PUT"];function qs(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,$s(t),Hs(t)}function $s(t){t.F||(t.F=!0,$e(t,"complete"),$e(t,"error"))}function zs(t){if(t.h&&void 0!==Pt&&(!t.C[1]||4!=Gs(t)||2!=t.da()))if(t.v&&4==Gs(t))rn(t.La,0,t);else if($e(t,"readystatechange"),4==Gs(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===o){var i=String(t.I).match(Xn)[1]||null;!i&&Ft.self&&Ft.self.location&&(i=Ft.self.location.protocol.slice(0,-1)),s=!Bs.test(i?i.toLowerCase():"")}n=s}if(n)$e(t,"complete"),$e(t,"success");else{t.m=6;try{var r=2<Gs(t)?t.g.statusText:""}catch(t){r=""}t.j=r+" ["+t.da()+"]",$s(t)}}finally{Hs(t)}}}function Hs(t,e){if(t.g){Ks(t);const n=t.g,s=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||$e(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function Ks(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(Ft.clearTimeout(t.A),t.A=null)}function Gs(t){return t.g?t.g.readyState:0}function Qs(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Us:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ws(t){let e="";return Te(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Xs(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=Ws(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):ns(t,e,n))}function Ys(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Js(t){this.Ga=0,this.j=[],this.l=new dn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ys("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ys("baseRetryDelayMs",5e3,t),this.hb=Ys("retryDelaySeedMs",1e4,t),this.eb=Ys("forwardChannelMaxRetries",2,t),this.xa=Ys("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new ws(t&&t.concurrentRequestLimit),this.Ja=new As,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Zs(t){if(ei(t),3==t.H){var e=t.W++,n=Jn(t.I);if(ns(n,"SID",t.K),ns(n,"RID",e),ns(n,"TYPE","terminate"),ii(t,n),(e=new Rn(t,t.l,e)).L=2,e.A=ss(Jn(n)),n=!1,Ft.navigator&&Ft.navigator.sendBeacon)try{n=Ft.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&Ft.Image&&((new Image).src=e.A,n=!0),n||(e.g=mi(e.l,null),e.g.ha(e.A)),e.G=Date.now(),$n(e)}pi(t)}function ti(t){t.g&&(ci(t),t.g.cancel(),t.g=null)}function ei(t){ti(t),t.u&&(Ft.clearTimeout(t.u),t.u=null),hi(t),t.i.cancel(),t.m&&("number"==typeof t.m&&Ft.clearTimeout(t.m),t.m=null)}function ni(t){if(!Es(t.i)&&!t.m){t.m=!0;var e=t.Na;Ye||tn(),Je||(Ye(),Je=!0),Ze.add(e,t),t.C=0}}function si(t,e){var n;n=e?e.m:t.W++;const s=Jn(t.I);ns(s,"SID",t.K),ns(s,"RID",n),ns(s,"AID",t.V),ii(t,s),t.o&&t.s&&Xs(s,t.o,t.s),n=new Rn(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=ri(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Ss(t.i,n),Vn(n,s,e)}function ii(t,e){t.na&&Te(t.na,(function(t,n){ns(e,n,t)})),t.h&&Wn({},(function(t,n){ns(e,n,t)}))}function ri(t,e,n){n=Math.min(t.j.length,n);var s=t.h?zt(t.h.Va,t.h,t):null;t:{var i=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),r=!1;else try{ks(a,t,"req"+n+"_")}catch(t){s&&s(a)}}if(r){s=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,s}function oi(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Ye||tn(),Je||(Ye(),Je=!0),Ze.add(e,t),t.A=0}}function ai(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=_n(zt(t.Ma,t),di(t,t.A)),t.A++,0))}function ci(t){null!=t.B&&(Ft.clearTimeout(t.B),t.B=null)}function li(t){t.g=new Rn(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Jn(t.wa);ns(e,"RID","rpc"),ns(e,"SID",t.K),ns(e,"AID",t.V),ns(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&ns(e,"TO",t.qa),ns(e,"TYPE","xmlhttp"),ii(t,e),t.o&&t.s&&Xs(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=ss(Jn(e)),n.u=null,n.S=!0,Un(n,t)}function hi(t){null!=t.v&&(Ft.clearTimeout(t.v),t.v=null)}function ui(t,e){var n=null;if(t.g==e){hi(t),ci(t),t.g=null;var s=2}else{if(!Ts(t.i,e))return;n=e.F,Cs(t.i,e),s=1}if(0!=t.H)if(e.i)if(1==s){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;$e(s=mn(),new En(s,n)),ni(t)}else oi(t);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==s&&function(t,e){return!(_s(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=_n(zt(t.Na,t,e),di(t,t.C)),t.C++,0)))}(t,e)||2==s&&ai(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:fi(t,5);break;case 4:fi(t,10);break;case 3:fi(t,6);break;default:fi(t,2)}}function di(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function fi(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var s=zt(t.pb,t);n||(n=new Yn("//www.google.com/images/cleardot.gif"),Ft.location&&"http"==Ft.location.protocol||Zn(n,"https"),ss(n)),function(t,e){const n=new dn;if(Ft.Image){const s=new Image;s.onload=Ht(Ds,n,s,"TestLoadImage: loaded",!0,e),s.onerror=Ht(Ds,n,s,"TestLoadImage: error",!1,e),s.onabort=Ht(Ds,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=Ht(Ds,n,s,"TestLoadImage: timeout",!1,e),Ft.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=t}else e(!1)}(n.toString(),s)}else bn(2);t.H=0,t.h&&t.h.za(e),pi(t),ei(t)}function pi(t){if(t.H=0,t.ma=[],t.h){const e=xs(t.i);0==e.length&&0==t.j.length||(Xt(t.ma,e),Xt(t.ma,t.j),t.i.i.length=0,Wt(t.j),t.j.length=0),t.h.ya()}}function gi(t,e,n){var s=n instanceof Yn?Jn(n):new Yn(n);if(""!=s.g)e&&(s.g=e+"."+s.g),ts(s,s.m);else{var i=Ft.location;s=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var r=new Yn(null);s&&Zn(r,s),e&&(r.g=e),i&&ts(r,i),n&&(r.l=n),s=r}return n=t.F,e=t.Da,n&&e&&ns(s,n,e),ns(s,"VER",t.ra),ii(t,s),s}function mi(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new Vs(new Ns({ob:n})):new Vs(t.va)).Oa(t.J),e}function yi(){}function vi(){if(ae&&!(10<=Number(me)))throw Error("Environmental error: no available transport.")}function wi(t,e){qe.call(this),this.g=new Js(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Zt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Zt(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new _i(this)}function bi(t){Dn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Ei(){Nn.call(this),this.status=1}function _i(t){this.g=t}function Ti(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Si(t,e,n){n||(n=0);var s=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)s[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)s[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var r=t.g[3],o=e+(r^n&(i^r))+s[0]+3614090360&4294967295;o=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=(n=(i=(r=(e=n+(o<<7&4294967295|o>>>25))+((o=r+(i^e&(n^i))+s[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(e^n))+s[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(r^e))+s[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(i^r))+s[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^e&(n^i))+s[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(e^n))+s[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(r^e))+s[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(i^r))+s[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^e&(n^i))+s[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(e^n))+s[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(r^e))+s[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^n&(i^r))+s[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^e&(n^i))+s[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(e^n))+s[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(r^e))+s[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^r&(n^i))+s[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(e^n))+s[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(r^e))+s[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(i^r))+s[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^r&(n^i))+s[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(e^n))+s[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(r^e))+s[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(i^r))+s[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^r&(n^i))+s[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(e^n))+s[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(r^e))+s[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(i^r))+s[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^r&(n^i))+s[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(e^n))+s[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(r^e))+s[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^e&(i^r))+s[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^r)+s[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^i)+s[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^e^n)+s[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^e)+s[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^r)+s[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^i)+s[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^e^n)+s[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^e)+s[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^r)+s[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^i)+s[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^e^n)+s[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^e)+s[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^r)+s[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(e^n^i)+s[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^e^n)+s[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^e)+s[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~r))+s[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~i))+s[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(r|~n))+s[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~e))+s[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~r))+s[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~i))+s[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(r|~n))+s[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~e))+s[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~r))+s[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~i))+s[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(r|~n))+s[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~e))+s[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(e=n+((o=e+(i^(n|~r))+s[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(e|~i))+s[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=r+((o=i+(e^(r|~n))+s[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+s[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+r&4294967295}function Ci(t,e){this.h=e;for(var n=[],s=!0,i=t.length-1;0<=i;i--){var r=0|t[i];s&&r==e||(n[i]=r,s=!1)}this.g=n}(Rt=Vs.prototype).Oa=function(t){this.M=t},Rt.ha=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():An.g(),this.C=this.u?xn(this.u):xn(An),this.g.onreadystatechange=zt(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void qs(this,t)}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var i in s)n.set(i,s[i]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const t of s.keys())n.set(t,s.get(t))}s=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=Ft.FormData&&t instanceof Ft.FormData,!(0<=Qt(js,e))||s||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Ks(this),0<this.B&&((this.L=function(t){return ae&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=zt(this.ua,this)):this.A=rn(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){qs(this,t)}},Rt.ua=function(){void 0!==Pt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,$e(this,"timeout"),this.abort(8))},Rt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,$e(this,"complete"),$e(this,"abort"),Hs(this))},Rt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Hs(this,!0)),Vs.$.N.call(this)},Rt.La=function(){this.s||(this.G||this.v||this.l?zs(this):this.kb())},Rt.kb=function(){zs(this)},Rt.isActive=function(){return!!this.g},Rt.da=function(){try{return 2<Gs(this)?this.g.status:-1}catch(t){return-1}},Rt.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},Rt.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Fs(e)}},Rt.Ia=function(){return this.m},Rt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Rt=Js.prototype).ra=8,Rt.H=1,Rt.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const i=new Rn(this,this.l,t);let r=this.s;if(this.U&&(r?(r=Se(r),xe(r,this.U)):r=this.U),null!==this.o||this.O||(i.I=r,r=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var s=this.j[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=ri(this,i,e),ns(n=Jn(this.I),"RID",t),ns(n,"CVER",22),this.F&&ns(n,"X-HTTP-Session-Id",this.F),ii(this,n),r&&(this.O?e="headers="+encodeURIComponent(String(Ws(r)))+"&"+e:this.o&&Xs(n,this.o,r)),Ss(this.i,i),this.bb&&ns(n,"TYPE","init"),this.P?(ns(n,"$req",e),ns(n,"SID","null"),i.aa=!0,Vn(i,n,null)):Vn(i,n,e),this.H=2}}else 3==this.H&&(t?si(this,t):0==this.j.length||Es(this.i)||si(this))},Rt.Ma=function(){if(this.u=null,li(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=_n(zt(this.jb,this),t)}},Rt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,bn(10),ti(this),li(this))},Rt.ib=function(){null!=this.v&&(this.v=null,ti(this),ai(this),bn(19))},Rt.pb=function(t){t?(this.l.info("Successfully pinged google.com"),bn(2)):(this.l.info("Failed to ping google.com"),bn(1))},Rt.isActive=function(){return!!this.h&&this.h.isActive(this)},(Rt=yi.prototype).Ba=function(){},Rt.Aa=function(){},Rt.za=function(){},Rt.ya=function(){},Rt.isActive=function(){return!0},Rt.Va=function(){},vi.prototype.g=function(t,e){return new wi(t,e)},Kt(wi,qe),wi.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;bn(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=gi(t,null,t.Y),ni(t)},wi.prototype.close=function(){Zs(this.g)},wi.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=He(t),t=n);e.j.push(new vs(e.fb++,t)),3==e.H&&ni(e)},wi.prototype.N=function(){this.g.h=null,delete this.j,Zs(this.g),delete this.g,wi.$.N.call(this)},Kt(bi,Dn),Kt(Ei,Nn),Kt(_i,yi),_i.prototype.Ba=function(){$e(this.g,"a")},_i.prototype.Aa=function(t){$e(this.g,new bi(t))},_i.prototype.za=function(t){$e(this.g,new Ei)},_i.prototype.ya=function(){$e(this.g,"b")},Kt(Ti,(function(){this.blockSize=-1})),Ti.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ti.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,s=this.m,i=this.h,r=0;r<e;){if(0==i)for(;r<=n;)Si(this,t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(s[i++]=t.charCodeAt(r++),i==this.blockSize){Si(this,s),i=0;break}}else for(;r<e;)if(s[i++]=t[r++],i==this.blockSize){Si(this,s),i=0;break}}this.h=i,this.i+=e},Ti.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var s=0;32>s;s+=8)t[n++]=this.g[e]>>>s&255;return t};var xi={};function Ii(t){return-128<=t&&128>t?function(t,e){var n=xi;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new Ci([0|t],0>t?-1:0)}(t)}(t):new Ci([0|t],0>t?-1:0)}function Ai(t){if(isNaN(t)||!isFinite(t))return Di;if(0>t)return Mi(Ai(-t));for(var e=[],n=1,s=0;t>=n;s++)e[s]=t/n|0,n*=ki;return new Ci(e,0)}var ki=4294967296,Di=Ii(0),Ni=Ii(1),Li=Ii(16777216);function Ri(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function Oi(t){return-1==t.h}function Mi(t){for(var e=t.g.length,n=[],s=0;s<e;s++)n[s]=~t.g[s];return new Ci(n,~t.h).add(Ni)}function Pi(t,e){return t.add(Mi(e))}function Fi(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Vi(t,e){this.g=t,this.h=e}function Ui(t,e){if(Ri(e))throw Error("division by zero");if(Ri(t))return new Vi(Di,Di);if(Oi(t))return e=Ui(Mi(t),e),new Vi(Mi(e.g),Mi(e.h));if(Oi(e))return e=Ui(t,Mi(e)),new Vi(Mi(e.g),e.h);if(30<t.g.length){if(Oi(t)||Oi(e))throw Error("slowDivide_ only works with positive integers.");for(var n=Ni,s=e;0>=s.X(t);)n=Bi(n),s=Bi(s);var i=ji(n,1),r=ji(s,1);for(s=ji(s,2),n=ji(n,2);!Ri(s);){var o=r.add(s);0>=o.X(t)&&(i=i.add(n),r=o),s=ji(s,1),n=ji(n,1)}return e=Pi(t,i.R(e)),new Vi(i,e)}for(i=Di;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),s=48>=(s=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,s-48),o=(r=Ai(n)).R(e);Oi(o)||0<o.X(t);)o=(r=Ai(n-=s)).R(e);Ri(r)&&(r=Ni),i=i.add(r),t=Pi(t,o)}return new Vi(i,t)}function Bi(t){for(var e=t.g.length+1,n=[],s=0;s<e;s++)n[s]=t.D(s)<<1|t.D(s-1)>>>31;return new Ci(n,t.h)}function ji(t,e){var n=e>>5;e%=32;for(var s=t.g.length-n,i=[],r=0;r<s;r++)i[r]=0<e?t.D(r+n)>>>e|t.D(r+n+1)<<32-e:t.D(r+n);return new Ci(i,t.h)}(Rt=Ci.prototype).ea=function(){if(Oi(this))return-Mi(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var s=this.D(n);t+=(0<=s?s:ki+s)*e,e*=ki}return t},Rt.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(Ri(this))return"0";if(Oi(this))return"-"+Mi(this).toString(t);for(var e=Ai(Math.pow(t,6)),n=this,s="";;){var i=Ui(n,e).g,r=((0<(n=Pi(n,i.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(Ri(n=i))return r+s;for(;6>r.length;)r="0"+r;s=r+s}},Rt.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},Rt.X=function(t){return Oi(t=Pi(this,t))?-1:Ri(t)?0:1},Rt.abs=function(){return Oi(this)?Mi(this):this},Rt.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0,i=0;i<=e;i++){var r=s+(65535&this.D(i))+(65535&t.D(i)),o=(r>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);s=o>>>16,r&=65535,o&=65535,n[i]=o<<16|r}return new Ci(n,-2147483648&n[n.length-1]?-1:0)},Rt.R=function(t){if(Ri(this)||Ri(t))return Di;if(Oi(this))return Oi(t)?Mi(this).R(Mi(t)):Mi(Mi(this).R(t));if(Oi(t))return Mi(this.R(Mi(t)));if(0>this.X(Li)&&0>t.X(Li))return Ai(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],s=0;s<2*e;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var i=0;i<t.g.length;i++){var r=this.D(s)>>>16,o=65535&this.D(s),a=t.D(i)>>>16,c=65535&t.D(i);n[2*s+2*i]+=o*c,Fi(n,2*s+2*i),n[2*s+2*i+1]+=r*c,Fi(n,2*s+2*i+1),n[2*s+2*i+1]+=o*a,Fi(n,2*s+2*i+1),n[2*s+2*i+2]+=r*a,Fi(n,2*s+2*i+2)}for(s=0;s<e;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=e;s<2*e;s++)n[s]=0;return new Ci(n,0)},Rt.gb=function(t){return Ui(this,t).h},Rt.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)&t.D(s);return new Ci(n,this.h&t.h)},Rt.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)|t.D(s);return new Ci(n,this.h|t.h)},Rt.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)^t.D(s);return new Ci(n,this.h^t.h)},vi.prototype.createWebChannel=vi.prototype.g,wi.prototype.send=wi.prototype.u,wi.prototype.open=wi.prototype.m,wi.prototype.close=wi.prototype.close,Tn.NO_ERROR=0,Tn.TIMEOUT=8,Tn.HTTP_ERROR=6,Sn.COMPLETE="complete",In.EventType=kn,kn.OPEN="a",kn.CLOSE="b",kn.ERROR="c",kn.MESSAGE="d",qe.prototype.listen=qe.prototype.O,Vs.prototype.listenOnce=Vs.prototype.P,Vs.prototype.getLastError=Vs.prototype.Sa,Vs.prototype.getLastErrorCode=Vs.prototype.Ia,Vs.prototype.getStatus=Vs.prototype.da,Vs.prototype.getResponseJson=Vs.prototype.Wa,Vs.prototype.getResponseText=Vs.prototype.ja,Vs.prototype.send=Vs.prototype.ha,Vs.prototype.setWithCredentials=Vs.prototype.Oa,Ti.prototype.digest=Ti.prototype.l,Ti.prototype.reset=Ti.prototype.reset,Ti.prototype.update=Ti.prototype.j,Ci.prototype.add=Ci.prototype.add,Ci.prototype.multiply=Ci.prototype.R,Ci.prototype.modulo=Ci.prototype.gb,Ci.prototype.compare=Ci.prototype.X,Ci.prototype.toNumber=Ci.prototype.ea,Ci.prototype.toString=Ci.prototype.toString,Ci.prototype.getBits=Ci.prototype.D,Ci.fromNumber=Ai,Ci.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return Mi(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var s=Ai(Math.pow(n,8)),i=Di,r=0;r<e.length;r+=8){var o=Math.min(8,e.length-r),a=parseInt(e.substring(r,r+o),n);8>o?(o=Ai(Math.pow(n,o)),i=i.R(o).add(Ai(a))):i=(i=i.R(s)).add(Ai(a))}return i};var qi=Mt.createWebChannelTransport=function(){return new vi},$i=Mt.getStatEventTarget=function(){return mn()},zi=Mt.ErrorCode=Tn,Hi=Mt.EventType=Sn,Ki=Mt.Event=pn,Gi=Mt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Qi=(Mt.FetchXmlHttpFactory=Ns,Mt.WebChannel=In),Wi=Mt.XhrIo=Vs,Xi=Mt.Md5=Ti,Yi=Mt.Integer=Ci;const Ji="@firebase/firestore";class Zi{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Zi.UNAUTHENTICATED=new Zi(null),Zi.GOOGLE_CREDENTIALS=new Zi("google-credentials-uid"),Zi.FIRST_PARTY=new Zi("first-party-uid"),Zi.MOCK_USER=new Zi("mock-user");let tr="10.7.2";const er=new z("@firebase/firestore");function nr(){return er.logLevel}function sr(t,...e){if(er.logLevel<=U.DEBUG){const n=e.map(or);er.debug(`Firestore (${tr}): ${t}`,...n)}}function ir(t,...e){if(er.logLevel<=U.ERROR){const n=e.map(or);er.error(`Firestore (${tr}): ${t}`,...n)}}function rr(t,...e){if(er.logLevel<=U.WARN){const n=e.map(or);er.warn(`Firestore (${tr}): ${t}`,...n)}}function or(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function ar(t="Unexpected state"){const e=`FIRESTORE (${tr}) INTERNAL ASSERTION FAILED: `+t;throw ir(e),new Error(e)}function cr(t,e){t||ar()}function lr(t,e){return t}const hr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ur extends A{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class dr{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class fr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class pr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Zi.UNAUTHENTICATED)))}shutdown(){}}class gr{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class mr{constructor(t){this.t=t,this.currentUser=Zi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new dr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new dr,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{sr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(sr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new dr)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(sr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(cr("string"==typeof e.accessToken),new fr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return cr(null===t||"string"==typeof t),new Zi(t)}}class yr{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Zi.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class vr{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new yr(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Zi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class wr{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class br{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&sr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,sr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{sr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?s(t):sr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(cr("string"==typeof t.token),this.R=t.token,new wr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Er(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class _r{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Er(40);for(let s=0;s<n.length;++s)e.length<20&&n[s]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[s]%62))}return e}}function Tr(t,e){return t<e?-1:t>e?1:0}function Sr(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}class Cr{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ur(hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ur(hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ur(hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ur(hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Cr.fromMillis(Date.now())}static fromDate(t){return Cr.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Cr(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Tr(this.nanoseconds,t.nanoseconds):Tr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class xr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new xr(t)}static min(){return new xr(new Cr(0,0))}static max(){return new xr(new Cr(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ir{constructor(t,e,n){void 0===e?e=0:e>t.length&&ar(),void 0===n?n=t.length-e:n>t.length-e&&ar(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Ir.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Ir?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Ar extends Ir{construct(t,e,n){return new Ar(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new ur(hr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Ar(e)}static emptyPath(){return new Ar([])}}const kr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Dr extends Ir{construct(t,e,n){return new Dr(t,e,n)}static isValidIdentifier(t){return kr.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Dr.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Dr(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new ur(hr.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new ur(hr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new ur(hr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new ur(hr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Dr(e)}static emptyPath(){return new Dr([])}}class Nr{constructor(t){this.path=t}static fromPath(t){return new Nr(Ar.fromString(t))}static fromName(t){return new Nr(Ar.fromString(t).popFirst(5))}static empty(){return new Nr(Ar.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Ar.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Ar.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Nr(new Ar(t.slice()))}}function Lr(t){return new Rr(t.readTime,t.key,-1)}class Rr{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Rr(xr.min(),Nr.empty(),-1)}static max(){return new Rr(xr.max(),Nr.empty(),-1)}}function Or(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Nr.comparator(t.documentKey,e.documentKey),0!==n?n:Tr(t.largestBatchId,e.largestBatchId))}const Mr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Pr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Fr(t){if(t.code!==hr.FAILED_PRECONDITION||t.message!==Mr)throw t;sr("LocalStore","Unexpectedly lost primary lease")}class Vr{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&ar(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Vr(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Vr?e:Vr.resolve(e)}catch(t){return Vr.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Vr.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Vr.reject(e)}static resolve(t){return new Vr(((e,n)=>{e(t)}))}static reject(t){return new Vr(((e,n)=>{n(t)}))}static waitFor(t){return new Vr(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=Vr.resolve(!1);for(const n of t)e=e.next((t=>t?Vr.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}static mapArray(t,e){return new Vr(((n,s)=>{const i=t.length,r=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{r[c]=t,++o,o===i&&n(r)}),(t=>s(t)))}}))}static doWhile(t,e){return new Vr(((n,s)=>{const i=()=>{!0===t()?e().next((()=>{i()}),s):n()};i()}))}}class Ur{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new dr,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new qr(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=Gr(e.target.error);this.V.reject(new qr(t,n))}}static open(t,e,n,s){try{return new Ur(e,t.transaction(s,n))}catch(t){throw new qr(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(sr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new zr(e)}}class Br{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===Br.S(x())&&ir("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return sr("SimpleDb","Removing database:",t),Hr(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!I())return!1;if(Br.C())return!0;const t=x(),e=Br.S(t),n=0<e&&e<10,s=Br.v(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(sr("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=t=>{const n=t.target.result;e(n)},s.onblocked=()=>{n(new qr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{const s=e.target.error;"VersionError"===s.name?n(new ur(hr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new ur(hr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new qr(t,s))},s.onupgradeneeded=t=>{sr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,s.transaction,t.oldVersion,this.version).next((()=>{sr("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i="readonly"===e;let r=0;for(;;){++r;try{this.db=await this.O(t);const e=Ur.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),Vr.reject(t)))).toPromise();return r.catch((()=>{})),await e.m,r}catch(t){const e=t,n="FirebaseError"!==e.name&&r<3;if(sr("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class jr{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Hr(this.k.delete())}}class qr extends ur{constructor(t,e){super(hr.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function $r(t){return"IndexedDbTransactionError"===t.name}class zr{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(sr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(sr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Hr(n)}add(t){return sr("SimpleDb","ADD",this.store.name,t,t),Hr(this.store.add(t))}get(t){return Hr(this.store.get(t)).next((e=>(void 0===e&&(e=null),sr("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return sr("SimpleDb","DELETE",this.store.name,t),Hr(this.store.delete(t))}count(){return sr("SimpleDb","COUNT",this.store.name),Hr(this.store.count())}W(t,e){const n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if("function"==typeof s.getAll){const t=s.getAll(n.range);return new Vr(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new Vr(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){sr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const s=this.cursor(n);return this.G(s,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.G(s,e)}Z(t){const e=this.cursor({});return new Vr(((n,s)=>{e.onerror=t=>{const e=Gr(t.target.error);s(e)},e.onsuccess=e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next((t=>{t?s.continue():n()})):n()}}))}G(t,e){const n=[];return new Vr(((s,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void s();const r=new jr(i),o=e(i.primaryKey,i.value,r);if(o instanceof Vr){const t=o.catch((t=>(r.done(),Vr.reject(t))));n.push(t)}r.isDone?s():null===r.$?i.continue():i.continue(r.$)}})).next((()=>Vr.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Hr(t){return new Vr(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Gr(t.target.error);n(e)}}))}let Kr=!1;function Gr(t){const e=Br.S(x());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new ur("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Kr||(Kr=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Qr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function Wr(t){return null==t}function Xr(t){return 0===t&&1/t==-1/0}Qr._e=-1;function Yr(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Jr(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Zr(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class to{constructor(t,e){this.comparator=t,this.root=e||no.EMPTY}insert(t,e){return new to(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,no.BLACK,null,null))}remove(t){return new to(this.comparator,this.root.remove(t,this.comparator).copy(null,null,no.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new eo(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new eo(this.root,t,this.comparator,!1)}getReverseIterator(){return new eo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new eo(this.root,t,this.comparator,!0)}}class eo{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class no{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:no.RED,this.left=null!=s?s:no.EMPTY,this.right=null!=i?i:no.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new no(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return no.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return no.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,no.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,no.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ar();if(this.right.isRed())throw ar();const t=this.left.check();if(t!==this.right.check())throw ar();return t+(this.isRed()?0:1)}}no.EMPTY=null,no.RED=!0,no.BLACK=!1,no.EMPTY=new class{constructor(){this.size=0}get key(){throw ar()}get value(){throw ar()}get color(){throw ar()}get left(){throw ar()}get right(){throw ar()}copy(t,e,n,s,i){return this}insert(t,e,n){return new no(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class so{constructor(t){this.comparator=t,this.data=new to(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new io(this.data.getIterator())}getIteratorFrom(t){return new io(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof so))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new so(this.comparator);return e.data=t,e}}class io{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ro{constructor(t){this.fields=t,t.sort(Dr.comparator)}static empty(){return new ro([])}unionWith(t){let e=new so(Dr.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new ro(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Sr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class oo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ao{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new oo("Invalid base64 string: "+t):t}}(t);return new ao(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ao(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Tr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ao.EMPTY_BYTE_STRING=new ao("");const co=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lo(t){if(cr(!!t),"string"==typeof t){let e=0;const n=co.exec(t);if(cr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ho(t.seconds),nanos:ho(t.nanos)}}function ho(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function uo(t){return"string"==typeof t?ao.fromBase64String(t):ao.fromUint8Array(t)}function fo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function po(t){const e=t.mapValue.fields.__previous_value__;return fo(e)?po(e):e}function go(t){const e=lo(t.mapValue.fields.__local_write_time__.timestampValue);return new Cr(e.seconds,e.nanos)}class mo{constructor(t,e,n,s,i,r,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class yo{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new yo("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof yo&&t.projectId===this.projectId&&t.database===this.database}}const vo={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function wo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?fo(t)?4:Lo(t)?9007199254740991:10:ar()}function bo(t,e){if(t===e)return!0;const n=wo(t);if(n!==wo(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return go(t).isEqual(go(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=lo(t.timestampValue),s=lo(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return uo(t.bytesValue).isEqual(uo(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ho(t.geoPointValue.latitude)===ho(e.geoPointValue.latitude)&&ho(t.geoPointValue.longitude)===ho(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ho(t.integerValue)===ho(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=ho(t.doubleValue),s=ho(e.doubleValue);return n===s?Xr(n)===Xr(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Sr(t.arrayValue.values||[],e.arrayValue.values||[],bo);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Yr(n)!==Yr(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!bo(n[t],s[t])))return!1;return!0}(t,e);default:return ar()}}function Eo(t,e){return void 0!==(t.values||[]).find((t=>bo(t,e)))}function _o(t,e){if(t===e)return 0;const n=wo(t),s=wo(e);if(n!==s)return Tr(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return Tr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=ho(t.integerValue||t.doubleValue),s=ho(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return To(t.timestampValue,e.timestampValue);case 4:return To(go(t),go(e));case 5:return Tr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=uo(t),s=uo(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=Tr(n[t],s[t]);if(0!==e)return e}return Tr(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Tr(ho(t.latitude),ho(e.latitude));return 0!==n?n:Tr(ho(t.longitude),ho(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=_o(n[t],s[t]);if(e)return e}return Tr(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===vo.mapValue&&e===vo.mapValue)return 0;if(t===vo.mapValue)return 1;if(e===vo.mapValue)return-1;const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=Tr(s[t],r[t]);if(0!==e)return e;const o=_o(n[s[t]],i[r[t]]);if(0!==o)return o}return Tr(s.length,r.length)}(t.mapValue,e.mapValue);default:throw ar()}}function To(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Tr(t,e);const n=lo(t),s=lo(e),i=Tr(n.seconds,s.seconds);return 0!==i?i:Tr(n.nanos,s.nanos)}function So(t){return Co(t)}function Co(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=lo(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return uo(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return Nr.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Co(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${Co(t.fields[i])}`;return n+"}"}(t.mapValue):ar()}function xo(t){return!!t&&"integerValue"in t}function Io(t){return!!t&&"arrayValue"in t}function Ao(t){return!!t&&"nullValue"in t}function ko(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Do(t){return!!t&&"mapValue"in t}function No(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Jr(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=No(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=No(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Lo(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Ro{constructor(t){this.value=t}static empty(){return new Ro({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Do(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=No(e)}setAll(t){let e=Dr.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=No(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());Do(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return bo(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Do(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Jr(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Ro(No(this.value))}}function Oo(t){const e=[];return Jr(t.fields,((t,n)=>{const s=new Dr([t]);if(Do(n)){const t=Oo(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new ro(e)}class Mo{constructor(t,e,n,s,i,r,o){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=r,this.documentState=o}static newInvalidDocument(t){return new Mo(t,0,xr.min(),xr.min(),xr.min(),Ro.empty(),0)}static newFoundDocument(t,e,n,s){return new Mo(t,1,e,xr.min(),n,s,0)}static newNoDocument(t,e){return new Mo(t,2,e,xr.min(),xr.min(),Ro.empty(),0)}static newUnknownDocument(t,e){return new Mo(t,3,e,xr.min(),xr.min(),Ro.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(xr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ro.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ro.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=xr.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Mo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Mo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Po{constructor(t,e){this.position=t,this.inclusive=e}}function Fo(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?Nr.comparator(Nr.fromName(o.referenceValue),n.key):_o(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function Vo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!bo(t.position[n],e.position[n]))return!1;return!0}class Uo{constructor(t,e="asc"){this.field=t,this.dir=e}}function Bo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class jo{}class qo extends jo{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Wo(t,e,n):"array-contains"===e?new Zo(t,n):"in"===e?new ta(t,n):"not-in"===e?new ea(t,n):"array-contains-any"===e?new na(t,n):new qo(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Xo(t,n):new Yo(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(_o(e,this.value)):null!==e&&wo(this.value)===wo(e)&&this.matchesComparison(_o(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ar()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $o extends jo{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new $o(t,e)}matches(t){return zo(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function zo(t){return"and"===t.op}function Ho(t){return function(t){for(const e of t.filters)if(e instanceof $o)return!1;return!0}(t)&&zo(t)}function Ko(t){if(t instanceof qo)return t.field.canonicalString()+t.op.toString()+So(t.value);if(Ho(t))return t.filters.map((t=>Ko(t))).join(",");{const e=t.filters.map((t=>Ko(t))).join(",");return`${t.op}(${e})`}}function Go(t,e){return t instanceof qo?function(t,e){return e instanceof qo&&t.op===e.op&&t.field.isEqual(e.field)&&bo(t.value,e.value)}(t,e):t instanceof $o?function(t,e){return e instanceof $o&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,s)=>t&&Go(n,e.filters[s])),!0)}(t,e):void ar()}function Qo(t){return t instanceof qo?function(t){return`${t.field.canonicalString()} ${t.op} ${So(t.value)}`}(t):t instanceof $o?function(t){return t.op.toString()+" {"+t.getFilters().map(Qo).join(" ,")+"}"}(t):"Filter"}class Wo extends qo{constructor(t,e,n){super(t,e,n),this.key=Nr.fromName(n.referenceValue)}matches(t){const e=Nr.comparator(t.key,this.key);return this.matchesComparison(e)}}class Xo extends qo{constructor(t,e){super(t,"in",e),this.keys=Jo(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Yo extends qo{constructor(t,e){super(t,"not-in",e),this.keys=Jo(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Jo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Nr.fromName(t.referenceValue)))}class Zo extends qo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Io(e)&&Eo(e.arrayValue,this.value)}}class ta extends qo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Eo(this.value.arrayValue,e)}}class ea extends qo{constructor(t,e){super(t,"not-in",e)}matches(t){if(Eo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Eo(this.value.arrayValue,e)}}class na extends qo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Io(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Eo(this.value.arrayValue,t)))}}class sa{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.ce=null}}function ia(t,e=null,n=[],s=[],i=null,r=null,o=null){return new sa(t,e,n,s,i,r,o)}function ra(t){const e=lr(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Ko(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Wr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>So(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>So(t))).join(",")),e.ce=t}return e.ce}function oa(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Bo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Go(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Vo(t.startAt,e.startAt)&&Vo(t.endAt,e.endAt)}function aa(t){return Nr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class ca{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function la(t){return new ca(t)}function ha(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function ua(t){const e=lr(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",s=function(t){let e=new so(Dr.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);s.forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new Uo(s,n))})),t.has(Dr.keyField().canonicalString())||e.le.push(new Uo(Dr.keyField(),n))}return e.le}function da(t){const e=lr(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return ia(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Uo(t.field,e)}));const n=t.endAt?new Po(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new Po(t.startAt.position,t.startAt.inclusive):null;return ia(t.path,t.collectionGroup,e,t.filters,t.limit,n,s)}}(e,ua(t))),e.he}function fa(t,e,n){return new ca(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function pa(t,e){return oa(da(t),da(e))&&t.limitType===e.limitType}function ga(t){return`${ra(da(t))}|lt:${t.limitType}`}function ma(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Qo(t))).join(", ")}]`),Wr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>So(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>So(t))).join(",")),`Target(${e})`}(da(t))}; limitType=${t.limitType})`}function ya(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Nr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of ua(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=Fo(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,ua(t),e)||t.endAt&&!function(t,e,n){const s=Fo(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,ua(t),e))}(t,e)}function va(t){return(e,n)=>{let s=!1;for(const i of ua(t)){const t=wa(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function wa(t,e,n){const s=t.field.isKeyField()?Nr.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?_o(s,i):ar()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return ar()}}class ba{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Jr(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return Zr(this.inner)}size(){return this.innerSize}}const Ea=new to(Nr.comparator);function _a(){return Ea}const Ta=new to(Nr.comparator);function Sa(...t){let e=Ta;for(const n of t)e=e.insert(n.key,n);return e}function Ca(t){let e=Ta;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function xa(){return Aa()}function Ia(){return Aa()}function Aa(){return new ba((t=>t.toString()),((t,e)=>t.isEqual(e)))}const ka=new to(Nr.comparator),Da=new so(Nr.comparator);function Na(...t){let e=Da;for(const n of t)e=e.add(n);return e}const La=new so(Tr);function Ra(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xr(e)?"-0":e}}function Oa(t){return{integerValue:""+t}}function Ma(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Xr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?Oa(e):Ra(t,e)}class Pa{constructor(){this._=void 0}}function Fa(t,e,n){return t instanceof Ba?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&fo(e)&&(e=po(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ja?qa(t,e):t instanceof $a?za(t,e):function(t,e){const n=Ua(t,e),s=Ka(n)+Ka(t.Ie);return xo(n)&&xo(t.Ie)?Oa(s):Ra(t.serializer,s)}(t,e)}function Va(t,e,n){return t instanceof ja?qa(t,e):t instanceof $a?za(t,e):n}function Ua(t,e){return t instanceof Ha?function(t){return xo(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Ba extends Pa{}class ja extends Pa{constructor(t){super(),this.elements=t}}function qa(t,e){const n=Ga(e);for(const e of t.elements)n.some((t=>bo(t,e)))||n.push(e);return{arrayValue:{values:n}}}class $a extends Pa{constructor(t){super(),this.elements=t}}function za(t,e){let n=Ga(e);for(const e of t.elements)n=n.filter((t=>!bo(t,e)));return{arrayValue:{values:n}}}class Ha extends Pa{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function Ka(t){return ho(t.integerValue||t.doubleValue)}function Ga(t){return Io(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Qa{constructor(t,e){this.version=t,this.transformResults=e}}class Wa{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Wa}static exists(t){return new Wa(void 0,t)}static updateTime(t){return new Wa(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Xa(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ya{}function Ja(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new cc(t.key,Wa.none()):new sc(t.key,t.data,Wa.none());{const n=t.data,s=Ro.empty();let i=new so(Dr.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?s.delete(t):s.set(t,e),i=i.add(t)}return new ic(t.key,s,new ro(i.toArray()),Wa.none())}}function Za(t,e,n){t instanceof sc?function(t,e,n){const s=t.value.clone(),i=oc(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof ic?function(t,e,n){if(!Xa(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=oc(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(rc(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function tc(t,e,n,s){return t instanceof sc?function(t,e,n,s){if(!Xa(t.precondition,e))return n;const i=t.value.clone(),r=ac(t.fieldTransforms,s,e);return i.setAll(r),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,s):t instanceof ic?function(t,e,n,s){if(!Xa(t.precondition,e))return n;const i=ac(t.fieldTransforms,s,e),r=e.data;return r.setAll(rc(t)),r.setAll(i),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,s):function(t,e,n){return Xa(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function ec(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=Ua(s.transform,t||null);null!=i&&(null===n&&(n=Ro.empty()),n.set(s.field,i))}return n||null}function nc(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Sr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ja&&e instanceof ja||t instanceof $a&&e instanceof $a?Sr(t.elements,e.elements,bo):t instanceof Ha&&e instanceof Ha?bo(t.Ie,e.Ie):t instanceof Ba&&e instanceof Ba}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class sc extends Ya{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ic extends Ya{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function rc(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function oc(t,e,n){const s=new Map;cr(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,a=e.data.field(r.field);s.set(r.field,Va(o,a,n[i]))}return s}function ac(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,Fa(t,r,e))}return s}class cc extends Ya{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class lc extends Ya{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class hc{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&Za(s,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=tc(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=tc(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Ia();return this.mutations.forEach((s=>{const i=t.get(s.key),r=i.overlayedDocument;let o=this.applyToLocalView(r,i.mutatedFields);o=e.has(s.key)?null:o;const a=Ja(r,o);null!==a&&n.set(s.key,a),r.isValidDocument()||r.convertToNoDocument(xr.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Na())}isEqual(t){return this.batchId===t.batchId&&Sr(this.mutations,t.mutations,((t,e)=>nc(t,e)))&&Sr(this.baseMutations,t.baseMutations,((t,e)=>nc(t,e)))}}class uc{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){cr(t.mutations.length===n.length);let s=ka;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new uc(t,e,n,s)}}class dc{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class fc{constructor(t,e){this.count=t,this.unchangedNames=e}}var pc,gc;function mc(t){if(void 0===t)return ir("GRPC error has no .code"),hr.UNKNOWN;switch(t){case pc.OK:return hr.OK;case pc.CANCELLED:return hr.CANCELLED;case pc.UNKNOWN:return hr.UNKNOWN;case pc.DEADLINE_EXCEEDED:return hr.DEADLINE_EXCEEDED;case pc.RESOURCE_EXHAUSTED:return hr.RESOURCE_EXHAUSTED;case pc.INTERNAL:return hr.INTERNAL;case pc.UNAVAILABLE:return hr.UNAVAILABLE;case pc.UNAUTHENTICATED:return hr.UNAUTHENTICATED;case pc.INVALID_ARGUMENT:return hr.INVALID_ARGUMENT;case pc.NOT_FOUND:return hr.NOT_FOUND;case pc.ALREADY_EXISTS:return hr.ALREADY_EXISTS;case pc.PERMISSION_DENIED:return hr.PERMISSION_DENIED;case pc.FAILED_PRECONDITION:return hr.FAILED_PRECONDITION;case pc.ABORTED:return hr.ABORTED;case pc.OUT_OF_RANGE:return hr.OUT_OF_RANGE;case pc.UNIMPLEMENTED:return hr.UNIMPLEMENTED;case pc.DATA_LOSS:return hr.DATA_LOSS;default:return ar()}}(gc=pc||(pc={}))[gc.OK=0]="OK",gc[gc.CANCELLED=1]="CANCELLED",gc[gc.UNKNOWN=2]="UNKNOWN",gc[gc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",gc[gc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",gc[gc.NOT_FOUND=5]="NOT_FOUND",gc[gc.ALREADY_EXISTS=6]="ALREADY_EXISTS",gc[gc.PERMISSION_DENIED=7]="PERMISSION_DENIED",gc[gc.UNAUTHENTICATED=16]="UNAUTHENTICATED",gc[gc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",gc[gc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",gc[gc.ABORTED=10]="ABORTED",gc[gc.OUT_OF_RANGE=11]="OUT_OF_RANGE",gc[gc.UNIMPLEMENTED=12]="UNIMPLEMENTED",gc[gc.INTERNAL=13]="INTERNAL",gc[gc.UNAVAILABLE=14]="UNAVAILABLE",gc[gc.DATA_LOSS=15]="DATA_LOSS";const yc=new Yi([4294967295,4294967295],0);function vc(t){const e=(new TextEncoder).encode(t),n=new Xi;return n.update(e),new Uint8Array(n.digest())}function wc(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new Yi([n,s],0),new Yi([i,r],0)]}class bc{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Ec(`Invalid padding: ${e}`);if(n<0)throw new Ec(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Ec(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Ec(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=Yi.fromNumber(this.Te)}de(t,e,n){let s=t.add(e.multiply(Yi.fromNumber(n)));return 1===s.compare(yc)&&(s=new Yi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ee).toNumber()}Ae(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=vc(t),[n,s]=wc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,s,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),r=new bc(i,s,e);return n.forEach((t=>r.insert(t))),r}insert(t){if(0===this.Te)return;const e=vc(t),[n,s]=wc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,s,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Ec extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class _c{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,Tc.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new _c(xr.min(),s,new to(Tr),_a(),Na())}}class Tc{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Tc(n,e,Na(),Na(),Na())}}class Sc{constructor(t,e,n,s){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=s}}class Cc{constructor(t,e){this.targetId=t,this.fe=e}}class xc{constructor(t,e,n=ao.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Ic{constructor(){this.ge=0,this.pe=Dc(),this.ye=ao.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=Na(),e=Na(),n=Na();return this.pe.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:ar()}})),new Tc(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=Dc()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,cr(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class Ac{constructor(t){this.Le=t,this.ke=new Map,this.qe=_a(),this.Qe=kc(),this.Ke=new to(Tr)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Be(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:ar()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,s=this.Ye(e);if(s){const i=s.target;if(aa(i))if(0===n){const t=new Nr(i.path);this.We(e,t,Mo.newNoDocument(t,xr.min()))}else cr(1===n);else{const s=this.Ze(e);if(s!==n){const n=this.Xe(t),i=n?this.et(n,t,s):1;if(0!==i){this.He(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e;let r,o;try{r=uo(n).toUint8Array()}catch(t){if(t instanceof oo)return rr("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new bc(r,s,i)}catch(t){return rr(t instanceof Ec?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let s=0;return n.forEach((n=>{const i=this.Le.nt(),r=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(r)||(this.We(e,n,null),s++)})),s}it(t){const e=new Map;this.ke.forEach(((n,s)=>{const i=this.Ye(s);if(i){if(n.current&&aa(i.target)){const e=new Nr(i.target.path);null!==this.qe.get(e)||this.st(s,e)||this.We(s,e,Mo.newNoDocument(e,t))}n.De&&(e.set(s,n.ve()),n.Fe())}}));let n=Na();this.Qe.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const s=new _c(t,e,this.Ke,this.qe,n);return this.qe=_a(),this.Qe=kc(),this.Ke=new to(Tr),s}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const s=this.ze(t);this.st(t,e)?s.Me(e,1):s.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new Ic,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new so(Tr),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||sr("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new Ic),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function kc(){return new to(Nr.comparator)}function Dc(){return new to(Nr.comparator)}const Nc={asc:"ASCENDING",desc:"DESCENDING"},Lc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Rc={and:"AND",or:"OR"};class Oc{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Mc(t,e){return t.useProto3Json||Wr(e)?e:{value:e}}function Pc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Fc(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Vc(t,e){return Pc(t,e.toTimestamp())}function Uc(t){return cr(!!t),xr.fromTimestamp(function(t){const e=lo(t);return new Cr(e.seconds,e.nanos)}(t))}function Bc(t,e){return jc(t,e).canonicalString()}function jc(t,e){const n=function(t){return new Ar(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function qc(t){const e=Ar.fromString(t);return cr(ol(e)),e}function $c(t,e){return Bc(t.databaseId,e.path)}function zc(t,e){const n=qc(e);if(n.get(1)!==t.databaseId.projectId)throw new ur(hr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ur(hr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Nr(Gc(n))}function Hc(t,e){return Bc(t.databaseId,e)}function Kc(t){return new Ar(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Gc(t){return cr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Qc(t,e,n){return{name:$c(t,e),fields:n.value.mapValue.fields}}function Wc(t,e){return{documents:[Hc(t,e.path)]}}function Xc(t,e){const n={structuredQuery:{}},s=e.path;let i;null!==e.collectionGroup?(i=s,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=Hc(t,i);const r=function(t){if(0!==t.length)return il($o.create(t,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:nl(t.field),direction:Zc(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Mc(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:i}}function Yc(t){let e=function(t){const e=qc(t);return 4===e.length?Ar.emptyPath():Gc(e)}(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){cr(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function(t){const e=Jc(t);return e instanceof $o&&Ho(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new Uo(sl(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Wr(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Po(n,e)}(n.startAt));let l=null;return n.endAt&&(l=function(t){const e=!t.before,n=t.values||[];return new Po(n,e)}(n.endAt)),function(t,e,n,s,i,r,o,a){return new ca(t,e,n,s,i,r,o,a)}(e,i,o,r,a,"F",c,l)}function Jc(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=sl(t.unaryFilter.field);return qo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=sl(t.unaryFilter.field);return qo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=sl(t.unaryFilter.field);return qo.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=sl(t.unaryFilter.field);return qo.create(i,"!=",{nullValue:"NULL_VALUE"});default:return ar()}}(t):void 0!==t.fieldFilter?function(t){return qo.create(sl(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ar()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return $o.create(t.compositeFilter.filters.map((t=>Jc(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return ar()}}(t.compositeFilter.op))}(t):ar()}function Zc(t){return Nc[t]}function tl(t){return Lc[t]}function el(t){return Rc[t]}function nl(t){return{fieldPath:t.canonicalString()}}function sl(t){return Dr.fromServerFormat(t.fieldPath)}function il(t){return t instanceof qo?function(t){if("=="===t.op){if(ko(t.value))return{unaryFilter:{field:nl(t.field),op:"IS_NAN"}};if(Ao(t.value))return{unaryFilter:{field:nl(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ko(t.value))return{unaryFilter:{field:nl(t.field),op:"IS_NOT_NAN"}};if(Ao(t.value))return{unaryFilter:{field:nl(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:nl(t.field),op:tl(t.op),value:t.value}}}(t):t instanceof $o?function(t){const e=t.getFilters().map((t=>il(t)));return 1===e.length?e[0]:{compositeFilter:{op:el(t.op),filters:e}}}(t):ar()}function rl(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ol(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class al{constructor(t,e,n,s,i=xr.min(),r=xr.min(),o=ao.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new al(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new al(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new al(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new al(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class cl{constructor(t){this.ct=t}}function ll(t){const e=Yc({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?fa(e,e.limit,"L"):e}class hl{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(ho(t.integerValue));else if("doubleValue"in t){const n=ho(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),Xr(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(uo(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?Lo(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):ar()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),Nr.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}hl.bt=new hl;class ul{constructor(){this._n=new dl}addToCollectionParentIndex(t,e){return this._n.add(e),Vr.resolve()}getCollectionParents(t,e){return Vr.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return Vr.resolve()}deleteFieldIndex(t,e){return Vr.resolve()}deleteAllFieldIndexes(t){return Vr.resolve()}createTargetIndexes(t,e){return Vr.resolve()}getDocumentsMatchingTarget(t,e){return Vr.resolve(null)}getIndexType(t,e){return Vr.resolve(0)}getFieldIndexes(t,e){return Vr.resolve([])}getNextCollectionGroupToUpdate(t){return Vr.resolve(null)}getMinOffset(t,e){return Vr.resolve(Rr.min())}getMinOffsetFromCollectionGroup(t,e){return Vr.resolve(Rr.min())}updateCollectionGroup(t,e,n){return Vr.resolve()}updateIndexEntries(t,e){return Vr.resolve()}}class dl{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new so(Ar.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new so(Ar.comparator)).toArray()}}new Uint8Array(0);class fl{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new fl(t,fl.DEFAULT_COLLECTION_PERCENTILE,fl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}fl.DEFAULT_COLLECTION_PERCENTILE=10,fl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,fl.DEFAULT=new fl(41943040,fl.DEFAULT_COLLECTION_PERCENTILE,fl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),fl.DISABLED=new fl(-1,0,0);class pl{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new pl(0)}static Bn(){return new pl(-1)}}class gl{constructor(){this.changes=new ba((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Mo.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Vr.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class ml{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class yl{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&tc(n.mutation,t,ro.empty(),Cr.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Na()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Na()){const s=xa();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((t=>{let e=Sa();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=xa();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Na())))}populateOverlays(t,e,n){const s=[];return n.forEach((t=>{e.has(t)||s.push(t)})),this.documentOverlayCache.getOverlays(t,s).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,s){let i=_a();const r=Aa(),o=Aa();return e.forEach(((t,e)=>{const o=n.get(e.key);s.has(e.key)&&(void 0===o||o.mutation instanceof ic)?i=i.insert(e.key,e):void 0!==o?(r.set(e.key,o.mutation.getFieldMask()),tc(o.mutation,e,o.mutation.getFieldMask(),Cr.now())):r.set(e.key,ro.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new ml(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Aa();let s=new to(((t,e)=>t-e)),i=Na();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||ro.empty();o=i.applyToLocalView(r,o),n.set(t,o);const a=(s.get(i.batchId)||Na()).add(t);s=s.insert(i.batchId,a)}))})).next((()=>{const r=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,c=s.value,l=Ia();c.forEach((t=>{if(!i.has(t)){const s=Ja(e.get(t),n.get(t));null!==s&&l.set(t,s),i=i.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,a,l))}return Vr.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,s){return function(t){return Nr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):Vr.resolve(xa());let o=-1,a=i;return r.next((e=>Vr.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?Vr.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,Na()))).next((t=>({batchId:o,changes:Ca(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Nr(e)).next((t=>{let e=Sa();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const i=e.collectionGroup;let r=Sa();return this.indexManager.getCollectionParents(t,i).next((o=>Vr.forEach(o,(o=>{const a=function(t,e){return new ca(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,s).next((t=>{t.forEach(((t,e)=>{r=r.insert(t,e)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s)))).next((t=>{i.forEach(((e,n)=>{const s=n.getKey();null===t.get(s)&&(t=t.insert(s,Mo.newInvalidDocument(s)))}));let n=Sa();return t.forEach(((t,s)=>{const r=i.get(t);void 0!==r&&tc(r.mutation,s,ro.empty(),Cr.now()),ya(e,s)&&(n=n.insert(t,s))})),n}))}}class vl{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return Vr.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Uc(t.createTime)}}(e)),Vr.resolve()}getNamedQuery(t,e){return Vr.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:ll(t.bundledQuery),readTime:Uc(t.readTime)}}(e)),Vr.resolve()}}class wl{constructor(){this.overlays=new to(Nr.comparator),this.hr=new Map}getOverlay(t,e){return Vr.resolve(this.overlays.get(e))}getOverlays(t,e){const n=xa();return Vr.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,s)=>{this.ht(t,e,s)})),Vr.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.hr.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),Vr.resolve()}getOverlaysForCollection(t,e,n){const s=xa(),i=e.length+1,r=new Nr(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===i&&t.largestBatchId>n&&s.set(t.getKey(),t)}return Vr.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new to(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=xa(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=xa(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=s)););return Vr.resolve(o)}ht(t,e,n){const s=this.overlays.get(n.key);if(null!==s){const t=this.hr.get(s.largestBatchId).delete(n.key);this.hr.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new dc(e,n));let i=this.hr.get(e);void 0===i&&(i=Na(),this.hr.set(e,i)),this.hr.set(e,i.add(n.key))}}class bl{constructor(){this.Pr=new so(El.Ir),this.Tr=new so(El.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new El(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new El(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new Nr(new Ar([])),n=new El(e,t),s=new El(e,t+1),i=[];return this.Tr.forEachInRange([n,s],(t=>{this.Ar(t),i.push(t.key)})),i}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new Nr(new Ar([])),n=new El(e,t),s=new El(e,t+1);let i=Na();return this.Tr.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new El(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class El{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return Nr.comparator(t.key,e.key)||Tr(t.pr,e.pr)}static Er(t,e){return Tr(t.pr,e.pr)||Nr.comparator(t.key,e.key)}}class _l{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new so(El.Ir)}checkEmpty(t){return Vr.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,s){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new hc(i,e,n,s);this.mutationQueue.push(r);for(const e of s)this.wr=this.wr.add(new El(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Vr.resolve(r)}lookupMutationBatch(t,e){return Vr.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.br(n),i=s<0?0:s;return Vr.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Vr.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return Vr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new El(e,0),s=new El(e,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,s],(t=>{const e=this.Sr(t.pr);i.push(e)})),Vr.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new so(Tr);return e.forEach((t=>{const e=new El(t,0),s=new El(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,s],(t=>{n=n.add(t.pr)}))})),Vr.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;Nr.isDocumentKey(i)||(i=i.child(""));const r=new El(new Nr(i),0);let o=new so(Tr);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.pr)),!0)}),r),Vr.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){cr(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Vr.forEach(e.mutations,(s=>{const i=new El(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new El(e,0),s=this.wr.firstAfterOrEqual(n);return Vr.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,Vr.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Tl{constructor(t){this.vr=t,this.docs=new to(Nr.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,r=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Vr.resolve(n?n.document.mutableCopy():Mo.newInvalidDocument(e))}getEntries(t,e){let n=_a();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Mo.newInvalidDocument(t))})),Vr.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=_a();const r=e.path,o=new Nr(r.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!r.isPrefixOf(t.path))break;t.path.length>r.length+1||Or(Lr(o),n)<=0||(s.has(o.key)||ya(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Vr.resolve(i)}getAllFromCollectionGroup(t,e,n,s){ar()}Fr(t,e){return Vr.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Sl(this)}getSize(t){return Vr.resolve(this.size)}}class Sl extends gl{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.ar.addEntry(t,s)):this.ar.removeEntry(n)})),Vr.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class Cl{constructor(t){this.persistence=t,this.Mr=new ba((t=>ra(t)),oa),this.lastRemoteSnapshotVersion=xr.min(),this.highestTargetId=0,this.Or=0,this.Nr=new bl,this.targetCount=0,this.Br=pl.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),Vr.resolve()}getLastRemoteSnapshotVersion(t){return Vr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Vr.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Br.next(),Vr.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),Vr.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Br=new pl(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,Vr.resolve()}updateTargetData(t,e){return this.qn(e),Vr.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,Vr.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Mr.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),Vr.waitFor(i).next((()=>s))}getTargetCount(t){return Vr.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return Vr.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),Vr.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),Vr.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),Vr.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return Vr.resolve(n)}containsKey(t,e){return Vr.resolve(this.Nr.containsKey(e))}}class xl{constructor(t,e){this.Lr={},this.overlays={},this.kr=new Qr(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Cl(this),this.indexManager=new ul,this.remoteDocumentCache=function(t){return new Tl(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new cl(e),this.$r=new vl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new wl,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Lr[t.toKey()];return n||(n=new _l(e,this.referenceDelegate),this.Lr[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){sr("MemoryPersistence","Starting transaction:",t);const s=new Il(this.kr.next());return this.referenceDelegate.Ur(),n(s).next((t=>this.referenceDelegate.Wr(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Gr(t,e){return Vr.or(Object.values(this.Lr).map((n=>()=>n.containsKey(t,e))))}}class Il extends Pr{constructor(t){super(),this.currentSequenceNumber=t}}class Al{constructor(t){this.persistence=t,this.zr=new bl,this.jr=null}static Hr(t){return new Al(t)}get Jr(){if(this.jr)return this.jr;throw ar()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),Vr.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),Vr.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),Vr.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Vr.forEach(this.Jr,(n=>{const s=Nr.fromPath(n);return this.Yr(t,s).next((t=>{t||e.removeEntry(s,xr.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return Vr.or([()=>Vr.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class kl{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=s}static Ki(t,e){let n=Na(),s=Na();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new kl(t,e.fromCache,n,s)}}class Dl{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Nl{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){var t;const e=null===(t=T())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()||!navigator.userAgent.includes("Safari")||navigator.userAgent.includes("Chrome")?Br.v(x())>0?6:4:8}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,s){const i={result:null};return this.ji(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.Hi(t,e,s,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new Dl;return this.Ji(t,e,n).next((s=>{if(i.result=s,this.Ui)return this.Yi(t,e,n,s.size)}))})).next((()=>i.result))}Yi(t,e,n,s){return n.documentReadCount<this.Wi?(nr()<=U.DEBUG&&sr("QueryEngine","SDK will not create cache indexes for query:",ma(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Vr.resolve()):(nr()<=U.DEBUG&&sr("QueryEngine","Query:",ma(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Gi*s?(nr()<=U.DEBUG&&sr("QueryEngine","The SDK decides to create cache indexes for query:",ma(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,da(e))):Vr.resolve())}ji(t,e){if(ha(e))return Vr.resolve(null);let n=da(e);return this.indexManager.getIndexType(t,n).next((s=>0===s?null:(null!==e.limit&&1===s&&(e=fa(e,null,"F"),n=da(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((s=>{const i=Na(...s);return this.zi.getDocuments(t,i).next((s=>this.indexManager.getMinOffset(t,n).next((n=>{const r=this.Zi(e,s);return this.Xi(e,r,i,n.readTime)?this.ji(t,fa(e,null,"F")):this.es(t,r,e,n)}))))})))))}Hi(t,e,n,s){return ha(e)||s.isEqual(xr.min())?Vr.resolve(null):this.zi.getDocuments(t,n).next((i=>{const r=this.Zi(e,i);return this.Xi(e,r,n,s)?Vr.resolve(null):(nr()<=U.DEBUG&&sr("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ma(e)),this.es(t,r,e,function(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,i=xr.fromTimestamp(1e9===s?new Cr(n+1,0):new Cr(n,s));return new Rr(i,Nr.empty(),e)}(s,-1)).next((t=>t)))}))}Zi(t,e){let n=new so(va(t));return e.forEach(((e,s)=>{ya(t,s)&&(n=n.add(s))})),n}Xi(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ji(t,e,n){return nr()<=U.DEBUG&&sr("QueryEngine","Using full collection scan to execute query:",ma(e)),this.zi.getDocumentsMatchingQuery(t,e,Rr.min(),n)}es(t,e,n,s){return this.zi.getDocumentsMatchingQuery(t,n,s).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Ll{constructor(t,e,n,s){this.persistence=t,this.ts=e,this.serializer=s,this.ns=new to(Tr),this.rs=new ba((t=>ra(t)),oa),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new yl(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function Rl(t,e){const n=lr(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.mutationQueue.getAllMutationBatches(t).next((i=>(s=i,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],r=[];let o=Na();for(const t of s){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:i,addedBatchIds:r})))}))}))}function Ol(t){const e=lr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}function Ml(t,e){const n=lr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function Pl(t,e,n){const s=lr(t),i=s.ns.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!$r(t))throw t;sr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.ns=s.ns.remove(e),s.rs.delete(i.target)}function Fl(t,e,n){const s=lr(t);let i=xr.min(),r=Na();return s.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const s=lr(t),i=s.rs.get(n);return void 0!==i?Vr.resolve(s.ns.get(i)):s.Qr.getTargetData(e,n)}(s,t,da(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.ts.getDocumentsMatchingQuery(t,e,n?i:xr.min(),n?r:Na()))).next((t=>(function(t,e,n){let s=t.ss.get(e)||xr.min();n.forEach(((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)})),t.ss.set(e,s)}(s,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:r})))))}class Vl{constructor(){this.activeTargetIds=La}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ul{constructor(){this.no=new Vl,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Vl,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Bl{io(t){}shutdown(){}}class jl{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){sr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){sr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ql=null;function $l(){return null===ql?ql=268435456+Math.round(2147483648*Math.random()):ql++,"0x"+ql.toString(16)}const zl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Hl{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const Kl="WebChannelConnection";class Gl extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po=`projects/${n}/databases/${s}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${s}`}get wo(){return!1}So(t,e,n,s,i){const r=$l(),o=this.bo(t,e.toUriEncodedString());sr("RestConnection",`Sending RPC '${t}' ${r}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,s,i),this.Co(t,o,a,n).then((e=>(sr("RestConnection",`Received RPC '${t}' ${r}: `,e),e)),(e=>{throw rr("RestConnection",`RPC '${t}' ${r} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,s,i,r){return this.So(t,e,n,s,i)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+tr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=zl[t];return`${this.fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,s){const i=$l();return new Promise(((r,o)=>{const a=new Wi;a.setWithCredentials(!0),a.listenOnce(Hi.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case zi.NO_ERROR:const e=a.getResponseJson();sr(Kl,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),r(e);break;case zi.TIMEOUT:sr(Kl,`RPC '${t}' ${i} timed out`),o(new ur(hr.DEADLINE_EXCEEDED,"Request time out"));break;case zi.HTTP_ERROR:const n=a.getStatus();if(sr(Kl,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(hr).indexOf(e)>=0?e:hr.UNKNOWN}(e.status);o(new ur(t,e.message))}else o(new ur(hr.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ur(hr.UNAVAILABLE,"Connection failed."));break;default:ar()}}finally{sr(Kl,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(s);sr(Kl,`RPC '${t}' ${i} sending request:`,s),a.send(e,"POST",c,n,15)}))}Fo(t,e,n){const s=$l(),i=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=qi(),o=$i(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const l=i.join("");sr(Kl,`Creating RPC '${t}' stream ${s}: ${l}`,a);const h=r.createWebChannel(l,a);let u=!1,d=!1;const f=new Hl({lo:e=>{d?sr(Kl,`Not sending because RPC '${t}' stream ${s} is closed:`,e):(u||(sr(Kl,`Opening RPC '${t}' stream ${s} transport.`),h.open(),u=!0),sr(Kl,`RPC '${t}' stream ${s} sending:`,e),h.send(e))},ho:()=>h.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(h,Qi.EventType.OPEN,(()=>{d||sr(Kl,`RPC '${t}' stream ${s} transport opened.`)})),p(h,Qi.EventType.CLOSE,(()=>{d||(d=!0,sr(Kl,`RPC '${t}' stream ${s} transport closed`),f.Vo())})),p(h,Qi.EventType.ERROR,(e=>{d||(d=!0,rr(Kl,`RPC '${t}' stream ${s} transport errored:`,e),f.Vo(new ur(hr.UNAVAILABLE,"The operation could not be completed")))})),p(h,Qi.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];cr(!!i);const r=i,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){sr(Kl,`RPC '${t}' stream ${s} received error:`,o);const e=o.status;let n=function(t){const e=pc[t];if(void 0!==e)return mc(e)}(e),i=o.message;void 0===n&&(n=hr.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new ur(n,i)),h.close()}else sr(Kl,`RPC '${t}' stream ${s} received:`,i),f.mo(i)}})),p(o,Ki.STAT_EVENT,(e=>{e.stat===Gi.PROXY?sr(Kl,`RPC '${t}' stream ${s} detected buffering proxy`):e.stat===Gi.NOPROXY&&sr(Kl,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function Ql(){return"undefined"!=typeof document?document:null}function Wl(t){return new Oc(t,!0)}class Xl{constructor(t,e,n=1e3,s=1.5,i=6e4){this.oi=t,this.timerId=e,this.Mo=n,this.xo=s,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),s=Math.max(0,e-n);s>0&&sr("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,s,(()=>(this.Lo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class Yl{constructor(t,e,n,s,i,r,o,a){this.oi=t,this.$o=n,this.Uo=s,this.connection=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Xl(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===hr.RESOURCE_EXHAUSTED?(ir(e.toString()),ir("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===hr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Wo===e&&this.o_(t,n)}),(e=>{t((()=>{const t=new ur(hr.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return sr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(sr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Jl extends Yl{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.serializer=i}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:ar()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.useProto3Json?(cr(void 0===e||"string"==typeof e),ao.fromBase64String(e||"")):(cr(void 0===e||e instanceof Uint8Array),ao.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?hr.UNKNOWN:mc(t.code);return new ur(e,t.message||"")}(o);n=new xc(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=zc(t,s.document.name),r=Uc(s.document.updateTime),o=s.document.createTime?Uc(s.document.createTime):xr.min(),a=new Ro({mapValue:{fields:s.document.fields}}),c=Mo.newFoundDocument(i,r,o,a),l=s.targetIds||[],h=s.removedTargetIds||[];n=new Sc(l,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=zc(t,s.document),r=s.readTime?Uc(s.readTime):xr.min(),o=Mo.newNoDocument(i,r),a=s.removedTargetIds||[];n=new Sc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=zc(t,s.document),r=s.removedTargetIds||[];n=new Sc([],r,i,null)}else{if(!("filter"in e))return ar();{e.filter;const t=e.filter;t.targetId;const{count:s=0,unchangedNames:i}=t,r=new fc(s,i),o=t.targetId;n=new Cc(o,r)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return xr.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?xr.min():e.readTime?Uc(e.readTime):xr.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=Kc(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;if(n=aa(s)?{documents:Wc(t,s)}:{query:Xc(t,s).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Fc(t,e.resumeToken);const s=Mc(t,e.expectedCount);null!==s&&(n.expectedCount=s)}else if(e.snapshotVersion.compareTo(xr.min())>0){n.readTime=Pc(t,e.snapshotVersion.toTimestamp());const s=Mc(t,e.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ar()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=Kc(this.serializer),e.removeTarget=t,this.t_(e)}}class Zl extends Yl{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(cr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();const e=function(t,e){return t&&t.length>0?(cr(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Uc(t.updateTime):Uc(e);return n.isEqual(xr.min())&&(n=Uc(e)),new Qa(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Uc(t.commitTime);return this.listener.T_(n,e)}return cr(!t.writeResults||0===t.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const t={};t.database=Kc(this.serializer),this.t_(t)}I_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof sc)n={update:Qc(t,e.key,e.value)};else if(e instanceof cc)n={delete:$c(t,e.key)};else if(e instanceof ic)n={update:Qc(t,e.key,e.data),updateMask:rl(e.fieldMask)};else{if(!(e instanceof lc))return ar();n={verify:$c(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ba)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ja)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof $a)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ha)return{fieldPath:e.field.canonicalString(),increment:n.Ie};throw ar()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Vc(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:ar()}(t,e.precondition)),n}(this.serializer,t)))};this.t_(e)}}class th extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.A_=!1}R_(){if(this.A_)throw new ur(hr.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.So(t,jc(e,n),s,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===hr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ur(hr.UNKNOWN,t.toString())}))}vo(t,e,n,s,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.vo(t,jc(e,n),s,r,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===hr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ur(hr.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class eh{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(ir(e),this.g_=!1):sr("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class nh{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((t=>{n.enqueueAndForget((async()=>{uh(this)&&(sr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=lr(t);e.v_.add(4),await ih(e),e.x_.set("Unknown"),e.v_.delete(4),await sh(e)}(this))}))})),this.x_=new eh(n,s)}}async function sh(t){if(uh(t))for(const e of t.F_)await e(!0)}async function ih(t){for(const e of t.F_)await e(!1)}function rh(t,e){const n=lr(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),hh(n)?lh(n):Ah(n).Jo()&&ah(n,e))}function oh(t,e){const n=lr(t),s=Ah(n);n.C_.delete(e),s.Jo()&&ch(n,e),0===n.C_.size&&(s.Jo()?s.Xo():uh(n)&&n.x_.set("Unknown"))}function ah(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(xr.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ah(t).c_(e)}function ch(t,e){t.O_.Oe(e),Ah(t).l_(e)}function lh(t){t.O_=new Ac({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Ah(t).start(),t.x_.p_()}function hh(t){return uh(t)&&!Ah(t).Ho()&&t.C_.size>0}function uh(t){return 0===lr(t).v_.size}function dh(t){t.O_=void 0}async function fh(t){t.C_.forEach(((e,n)=>{ah(t,e)}))}async function ph(t,e){dh(t),hh(t)?(t.x_.S_(e),lh(t)):t.x_.set("Unknown")}async function gh(t,e,n){if(t.x_.set("Online"),e instanceof xc&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.C_.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.C_.delete(s),t.O_.removeTarget(s))}(t,e)}catch(n){sr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await mh(t,n)}else if(e instanceof Sc?t.O_.$e(e):e instanceof Cc?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(xr.min()))try{const e=await Ol(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.C_.get(s);i&&t.C_.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const s=t.C_.get(e);if(!s)return;t.C_.set(e,s.withResumeToken(ao.EMPTY_BYTE_STRING,s.snapshotVersion)),ch(t,e);const i=new al(s.target,e,n,s.sequenceNumber);ah(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){sr("RemoteStore","Failed to raise snapshot:",e),await mh(t,e)}}async function mh(t,e,n){if(!$r(e))throw e;t.v_.add(1),await ih(t),t.x_.set("Offline"),n||(n=()=>Ol(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{sr("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await sh(t)}))}function yh(t,e){return e().catch((n=>mh(t,n,e)))}async function vh(t){const e=lr(t),n=kh(e);let s=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;wh(e);)try{const t=await Ml(e.localStore,s);if(null===t){0===e.D_.length&&n.Xo();break}s=t.batchId,bh(e,t)}catch(t){await mh(e,t)}Eh(e)&&_h(e)}function wh(t){return uh(t)&&t.D_.length<10}function bh(t,e){t.D_.push(e);const n=kh(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function Eh(t){return uh(t)&&!kh(t).Ho()&&t.D_.length>0}function _h(t){kh(t).start()}async function Th(t){kh(t).d_()}async function Sh(t){const e=kh(t);for(const n of t.D_)e.I_(n.mutations)}async function Ch(t,e,n){const s=t.D_.shift(),i=uc.from(s,e,n);await yh(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await vh(t)}async function xh(t,e){e&&kh(t).P_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return ar();case hr.CANCELLED:case hr.UNKNOWN:case hr.DEADLINE_EXCEEDED:case hr.RESOURCE_EXHAUSTED:case hr.INTERNAL:case hr.UNAVAILABLE:case hr.UNAUTHENTICATED:return!1;case hr.INVALID_ARGUMENT:case hr.NOT_FOUND:case hr.ALREADY_EXISTS:case hr.PERMISSION_DENIED:case hr.FAILED_PRECONDITION:case hr.ABORTED:case hr.OUT_OF_RANGE:case hr.UNIMPLEMENTED:case hr.DATA_LOSS:return!0}}(t)&&t!==hr.ABORTED}(e.code)){const n=t.D_.shift();kh(t).Zo(),await yh(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await vh(t)}}(t,e),Eh(t)&&_h(t)}async function Ih(t,e){const n=lr(t);n.asyncQueue.verifyOperationInProgress(),sr("RemoteStore","RemoteStore received new credentials");const s=uh(n);n.v_.add(3),await ih(n),s&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await sh(n)}function Ah(t){return t.N_||(t.N_=function(t,e,n){const s=lr(t);return s.R_(),new Jl(e,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(t.datastore,t.asyncQueue,{Po:fh.bind(null,t),To:ph.bind(null,t),u_:gh.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),hh(t)?lh(t):t.x_.set("Unknown")):(await t.N_.stop(),dh(t))}))),t.N_}function kh(t){return t.B_||(t.B_=function(t,e,n){const s=lr(t);return s.R_(),new Zl(e,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(t.datastore,t.asyncQueue,{Po:Th.bind(null,t),To:xh.bind(null,t),E_:Sh.bind(null,t),T_:Ch.bind(null,t)}),t.F_.push((async e=>{e?(t.B_.Zo(),await vh(t)):(await t.B_.stop(),t.D_.length>0&&(sr("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))}))),t.B_}class Dh{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new dr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new Dh(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ur(hr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Nh(t,e){if(ir("AsyncQueue",`${e}: ${t}`),$r(t))return new ur(hr.UNAVAILABLE,`${e}: ${t}`);throw t}class Lh{constructor(t){this.comparator=t?(e,n)=>t(e,n)||Nr.comparator(e.key,n.key):(t,e)=>Nr.comparator(t.key,e.key),this.keyedMap=Sa(),this.sortedSet=new to(this.comparator)}static emptySet(t){return new Lh(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Lh))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Lh;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Rh{constructor(){this.L_=new to(Nr.comparator)}track(t){const e=t.doc.key,n=this.L_.get(e);n?0!==t.type&&3===n.type?this.L_=this.L_.insert(e,t):3===t.type&&1!==n.type?this.L_=this.L_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.L_=this.L_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.L_=this.L_.remove(e):1===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):ar():this.L_=this.L_.insert(e,t)}k_(){const t=[];return this.L_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Oh{constructor(t,e,n,s,i,r,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,s,i){const r=[];return e.forEach((t=>{r.push({type:0,doc:t})})),new Oh(t,e,Lh.emptySet(e),r,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&pa(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Mh{constructor(){this.q_=void 0,this.Q_=[]}}class Ph{constructor(){this.queries=new ba((t=>ga(t)),pa),this.onlineState="Unknown",this.K_=new Set}}function Fh(t,e){const n=lr(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.Q_)e.W_(t)&&(s=!0);i.q_=t}}s&&Uh(n)}function Vh(t,e,n){const s=lr(t),i=s.queries.get(e);if(i)for(const t of i.Q_)t.onError(n);s.queries.delete(e)}function Uh(t){t.K_.forEach((t=>{t.next()}))}class Bh{constructor(t,e,n){this.query=t,this.G_=e,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Oh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.z_?this.H_(t)&&(this.G_.next(t),e=!0):this.J_(t,this.onlineState)&&(this.Y_(t),e=!0),this.j_=t,e}onError(t){this.G_.error(t)}U_(t){this.onlineState=t;let e=!1;return this.j_&&!this.z_&&this.J_(this.j_,t)&&(this.Y_(this.j_),e=!0),e}J_(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Z_||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}H_(t){if(t.docChanges.length>0)return!0;const e=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Y_(t){t=Oh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.z_=!0,this.G_.next(t)}}class jh{constructor(t){this.key=t}}class qh{constructor(t){this.key=t}}class $h{constructor(t,e){this.query=t,this.oa=e,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=Na(),this.mutatedKeys=Na(),this.ua=va(t),this.ca=new Lh(this.ua)}get la(){return this.oa}ha(t,e){const n=e?e.Pa:new Rh,s=e?e.ca:this.ca;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const l=s.get(t),h=ya(this.query,e)?e:null,u=!!l&&this.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;l&&h?l.data.isEqual(h.data)?u!==d&&(n.track({type:3,doc:h}),f=!0):this.Ia(l,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.ua(h,a)>0||c&&this.ua(h,c)<0)&&(o=!0)):!l&&h?(n.track({type:0,doc:h}),f=!0):l&&!h&&(n.track({type:1,doc:l}),f=!0,(a||c)&&(o=!0)),f&&(h?(r=r.add(h),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{ca:r,Pa:n,Xi:o,mutatedKeys:i}}Ia(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const i=this.ca;this.ca=t.ca,this.mutatedKeys=t.mutatedKeys;const r=t.Pa.k_();r.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ar()}};return n(t)-n(e)}(t.type,e.type)||this.ua(t.doc,e.doc))),this.Ta(n),s=null!=s&&s;const o=e&&!s?this.Ea():[],a=0===this.aa.size&&this.current&&!s?1:0,c=a!==this._a;return this._a=a,0!==r.length||c?{snapshot:new Oh(this.query,t.ca,i,r,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new Rh,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(t){return!this.oa.has(t)&&!!this.ca.has(t)&&!this.ca.get(t).hasLocalMutations}Ta(t){t&&(t.addedDocuments.forEach((t=>this.oa=this.oa.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.oa=this.oa.delete(t))),this.current=t.current)}Ea(){if(!this.current)return[];const t=this.aa;this.aa=Na(),this.ca.forEach((t=>{this.Aa(t.key)&&(this.aa=this.aa.add(t.key))}));const e=[];return t.forEach((t=>{this.aa.has(t)||e.push(new qh(t))})),this.aa.forEach((n=>{t.has(n)||e.push(new jh(n))})),e}Ra(t){this.oa=t.hs,this.aa=Na();const e=this.ha(t.documents);return this.applyChanges(e,!0)}Va(){return Oh.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class zh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Hh{constructor(t){this.key=t,this.ma=!1}}class Kh{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.fa={},this.ga=new ba((t=>ga(t)),pa),this.pa=new Map,this.ya=new Set,this.wa=new to(Nr.comparator),this.Sa=new Map,this.ba=new bl,this.Da={},this.Ca=new Map,this.va=pl.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function Gh(t,e){const n=function(t){const e=lr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Wh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Yh.bind(null,e),e.fa.u_=Fh.bind(null,e.eventManager),e.fa.xa=Vh.bind(null,e.eventManager),e}(t);let s,i;const r=n.ga.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.Va();else{const t=await function(t,e){const n=lr(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Qr.getTargetData(t,e).next((i=>i?(s=i,Vr.resolve(s)):n.Qr.allocateTargetId(t).next((i=>(s=new al(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.ns.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(n.localStore,da(e)),r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await async function(t,e,n,s,i){t.Ma=(e,n,s)=>async function(t,e,n,s){let i=e.view.ha(n);i.Xi&&(i=await Fl(t.localStore,e.query,!1).then((({documents:t})=>e.view.ha(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=s&&null!=s.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,r,o);return iu(t,e.targetId,a.da),a.snapshot}(t,e,n,s);const r=await Fl(t.localStore,e,!0),o=new $h(e,r.hs),a=o.ha(r.documents),c=Tc.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState,i),l=o.applyChanges(a,t.isPrimaryClient,c);iu(t,n,l.da);const h=new zh(e,n,o);return t.ga.set(e,h),t.pa.has(n)?t.pa.get(n).push(e):t.pa.set(n,[e]),l.snapshot}(n,e,s,"current"===r,t.resumeToken),n.isPrimaryClient&&rh(n.remoteStore,t)}return i}async function Qh(t,e){const n=lr(t),s=n.ga.get(e),i=n.pa.get(s.targetId);if(i.length>1)return n.pa.set(s.targetId,i.filter((t=>!pa(t,e)))),void n.ga.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Pl(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),oh(n.remoteStore,s.targetId),nu(n,s.targetId)})).catch(Fr)):(nu(n,s.targetId),await Pl(n.localStore,s.targetId,!0))}async function Wh(t,e){const n=lr(t);try{const t=await function(t,e){const n=lr(t),s=e.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];e.targetChanges.forEach(((r,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,r.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,r.addedDocuments,a))));let l=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?l=l.withResumeToken(ao.EMPTY_BYTE_STRING,xr.min()).withLastLimboFreeSnapshotVersion(xr.min()):r.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(r.resumeToken,s)),i=i.insert(a,l),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,r)&&o.push(n.Qr.updateTargetData(t,l))}));let a=_a(),c=Na();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(function(t,e,n){let s=Na(),i=Na();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=_a();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual(xr.min())?(e.removeEntry(n,r.readTime),s=s.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),s=s.insert(n,r)):sr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{cs:s,ls:i}}))}(t,r,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!s.isEqual(xr.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return Vr.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.Sa.get(e);s&&(cr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.ma=!0:t.modifiedDocuments.size>0?cr(s.ma):t.removedDocuments.size>0&&(cr(s.ma),s.ma=!1))})),await au(n,t,e)}catch(t){await Fr(t)}}function Xh(t,e,n){const s=lr(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.ga.forEach(((n,s)=>{const i=s.view.U_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=lr(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.Q_)t.U_(e)&&(s=!0)})),s&&Uh(n)}(s.eventManager,e),t.length&&s.fa.u_(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Yh(t,e,n){const s=lr(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.Sa.get(e),r=i&&i.key;if(r){let t=new to(Nr.comparator);t=t.insert(r,Mo.newNoDocument(r,xr.min()));const n=Na().add(r),i=new _c(xr.min(),new Map,new to(Tr),t,n);await Wh(s,i),s.wa=s.wa.remove(r),s.Sa.delete(e),ou(s)}else await Pl(s.localStore,e,!1).then((()=>nu(s,e,n))).catch(Fr)}async function Jh(t,e){const n=lr(t),s=e.batch.batchId;try{const t=await function(t,e){const n=lr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=Vr.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);cr(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=Na();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(n.localStore,e);eu(n,s,null),tu(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await au(n,t)}catch(t){await Fr(t)}}async function Zh(t,e,n){const s=lr(t);try{const t=await function(t,e){const n=lr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(cr(null!==e),s=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,s))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(s.localStore,e);eu(s,e,n),tu(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await au(s,t)}catch(n){await Fr(n)}}function tu(t,e){(t.Ca.get(e)||[]).forEach((t=>{t.resolve()})),t.Ca.delete(e)}function eu(t,e,n){const s=lr(t);let i=s.Da[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.Da[s.currentUser.toKey()]=i}}function nu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.pa.get(e))t.ga.delete(s),n&&t.fa.xa(s,n);t.pa.delete(e),t.isPrimaryClient&&t.ba.Vr(e).forEach((e=>{t.ba.containsKey(e)||su(t,e)}))}function su(t,e){t.ya.delete(e.path.canonicalString());const n=t.wa.get(e);null!==n&&(oh(t.remoteStore,n),t.wa=t.wa.remove(e),t.Sa.delete(n),ou(t))}function iu(t,e,n){for(const s of n)s instanceof jh?(t.ba.addReference(s.key,e),ru(t,s)):s instanceof qh?(sr("SyncEngine","Document no longer in limbo: "+s.key),t.ba.removeReference(s.key,e),t.ba.containsKey(s.key)||su(t,s.key)):ar()}function ru(t,e){const n=e.key,s=n.path.canonicalString();t.wa.get(n)||t.ya.has(s)||(sr("SyncEngine","New document in limbo: "+n),t.ya.add(s),ou(t))}function ou(t){for(;t.ya.size>0&&t.wa.size<t.maxConcurrentLimboResolutions;){const e=t.ya.values().next().value;t.ya.delete(e);const n=new Nr(Ar.fromString(e)),s=t.va.next();t.Sa.set(s,new Hh(n)),t.wa=t.wa.insert(n,s),rh(t.remoteStore,new al(da(la(n.path)),s,"TargetPurposeLimboResolution",Qr._e))}}async function au(t,e,n){const s=lr(t),i=[],r=[],o=[];s.ga.isEmpty()||(s.ga.forEach(((t,a)=>{o.push(s.Ma(a,e,n).then((t=>{if((t||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=kl.Ki(a.targetId,t);r.push(e)}})))})),await Promise.all(o),s.fa.u_(i),await async function(t,e){const n=lr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Vr.forEach(e,(e=>Vr.forEach(e.qi,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>Vr.forEach(e.Qi,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!$r(t))throw t;sr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.ns=n.ns.insert(e,i)}}}(s.localStore,r))}async function cu(t,e){const n=lr(t);if(!n.currentUser.isEqual(e)){sr("SyncEngine","User change. New user:",e.toKey());const t=await Rl(n.localStore,e);n.currentUser=e,function(t,e){t.Ca.forEach((t=>{t.forEach((t=>{t.reject(new ur(hr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ca.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await au(n,t.us)}}function lu(t,e){const n=lr(t),s=n.Sa.get(e);if(s&&s.ma)return Na().add(s.key);{let t=Na();const s=n.pa.get(e);if(!s)return t;for(const e of s){const s=n.ga.get(e);t=t.unionWith(s.view.la)}return t}}function hu(t){const e=lr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Jh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Zh.bind(null,e),e}class uu{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Wl(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,s){return new Ll(t,e,n,s)}(this.persistence,new Nl,t.initialUser,this.serializer)}createPersistence(t){return new xl(Al.Hr,this.serializer)}createSharedClientState(t){return new Ul}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class du{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Xh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=cu.bind(null,this.syncEngine),await async function(t,e){const n=lr(t);e?(n.v_.delete(2),await sh(n)):e||(n.v_.add(2),await ih(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Ph}createDatastore(t){const e=Wl(t.databaseInfo.databaseId),n=function(t){return new Gl(t)}(t.databaseInfo);return function(t,e,n,s){return new th(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,s,i){return new nh(t,e,n,s,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>Xh(this.syncEngine,t,0)),jl.D()?new jl:new Bl)}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const a=new Kh(t,e,n,s,i,r);return o&&(a.Fa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=lr(t);sr("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await ih(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class fu{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ba(this.observer.next,t)}error(t){this.observer.error?this.Ba(this.observer.error,t):ir("Uncaught Error in snapshot listener:",t.toString())}La(){this.muted=!0}Ba(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class pu{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=Zi.UNAUTHENTICATED,this.clientId=_r.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{sr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(sr("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ur(hr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new dr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Nh(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function gu(t,e){t.asyncQueue.verifyOperationInProgress(),sr("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await Rl(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function mu(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){sr("FirestoreClient","Using user provided OfflineComponentProvider");try{await gu(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===hr.FAILED_PRECONDITION||t.code===hr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;rr("Error using user provided cache. Falling back to memory cache: "+n),await gu(t,new uu)}}else sr("FirestoreClient","Using default OfflineComponentProvider"),await gu(t,new uu);return t._offlineComponents}(t);sr("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Ih(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Ih(e.remoteStore,n))),t._onlineComponents=e}async function yu(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(sr("FirestoreClient","Using user provided OnlineComponentProvider"),await mu(t,t._uninitializedComponentsProvider._online)):(sr("FirestoreClient","Using default OnlineComponentProvider"),await mu(t,new du))),t._onlineComponents}async function vu(t){const e=await yu(t),n=e.eventManager;return n.onListen=Gh.bind(null,e.syncEngine),n.onUnlisten=Qh.bind(null,e.syncEngine),n}function wu(t,e,n={}){const s=new dr;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new fu({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=lr(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.Q_.indexOf(e);t>=0&&(r.Q_.splice(t,1),i=0===r.Q_.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}(t,o))),n.fromCache&&"server"===s.source?i.reject(new ur(hr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Bh(n,r,{includeMetadataChanges:!0,Z_:!0});return async function(t,e){const n=lr(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new Mh),i)try{r.q_=await n.onListen(s)}catch(t){const n=Nh(t,`Initialization of query '${ma(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.Q_.push(e),e.U_(n.onlineState),r.q_&&e.W_(r.q_)&&Uh(n)}(t,o)}(await vu(t),t.asyncQueue,e,n,s))),s.promise}function bu(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Eu=new Map;function _u(t,e,n){if(!n)throw new ur(hr.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Tu(t){if(!Nr.isDocumentKey(t))throw new ur(hr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Su(t){if(Nr.isDocumentKey(t))throw new ur(hr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Cu(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":ar()}function xu(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ur(hr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Cu(t);throw new ur(hr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Iu{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new ur(hr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ur(hr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,s){if(!0===e&&!0===s)throw new ur(hr.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bu(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new ur(hr.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new ur(hr.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new ur(hr.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Au{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Iu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ur(hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new ur(hr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Iu(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new pr;switch(t.type){case"firstParty":return new vr(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new ur(hr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Eu.get(t);e&&(sr("ComponentProvider","Removing Datastore"),Eu.delete(t),e.terminate())}(this),Promise.resolve()}}class ku{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new ku(this.firestore,t,this._query)}}class Du{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Du(this.firestore,t,this._key)}}class Nu extends ku{constructor(t,e,n){super(t,e,la(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Du(this.firestore,null,new Nr(t))}withConverter(t){return new Nu(this.firestore,t,this._path)}}function Lu(t,e,...n){if(t=R(t),_u("collection","path",e),t instanceof Au){const s=Ar.fromString(e,...n);return Su(s),new Nu(t,null,s)}{if(!(t instanceof Du||t instanceof Nu))throw new ur(hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Ar.fromString(e,...n));return Su(s),new Nu(t.firestore,null,s)}}function Ru(t,e,...n){if(t=R(t),1===arguments.length&&(e=_r.newId()),_u("doc","path",e),t instanceof Au){const s=Ar.fromString(e,...n);return Tu(s),new Du(t,null,new Nr(s))}{if(!(t instanceof Du||t instanceof Nu))throw new ur(hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Ar.fromString(e,...n));return Tu(s),new Du(t.firestore,t instanceof Nu?t.converter:null,new Nr(s))}}class Ou{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new Xl(this,"async_queue_retry"),this._u=()=>{const t=Ql();t&&sr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=Ql();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.au(),this.uu(t)}enterRestrictedMode(t){if(!this.tu){this.tu=!0,this.su=t||!1;const e=Ql();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._u)}}enqueue(t){if(this.au(),this.tu)return new Promise((()=>{}));const e=new dr;return this.uu((()=>this.tu&&this.su?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.eu.push(t),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(t){if(!$r(t))throw t;sr("AsyncQueue","Operation failed with retryable error: "+t)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(t){const e=this.Xa.then((()=>(this.iu=!0,t().catch((t=>{this.ru=t,this.iu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw ir("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.iu=!1,t))))));return this.Xa=e,e}enqueueAfterDelay(t,e,n){this.au(),this.ou.indexOf(t)>-1&&(e=0);const s=Dh.createAndSchedule(this,t,e,n,(t=>this.lu(t)));return this.nu.push(s),s}au(){this.ru&&ar()}verifyOperationInProgress(){}async hu(){let t;do{t=this.Xa,await t}while(t!==this.Xa)}Pu(t){for(const e of this.nu)if(e.timerId===t)return!0;return!1}Iu(t){return this.hu().then((()=>{this.nu.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.nu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.hu()}))}Tu(t){this.ou.push(t)}lu(t){const e=this.nu.indexOf(t);this.nu.splice(e,1)}}class Mu extends Au{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Ou,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Fu(this),this._firestoreClient.terminate()}}function Pu(t){return t._firestoreClient||Fu(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Fu(t){var e,n,s;const i=t._freezeSettings(),r=function(t,e,n,s){return new mo(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,bu(s.experimentalLongPollingOptions),s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new pu(t._authCredentials,t._appCheckCredentials,t._queue,r),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=i.localCache)||void 0===s?void 0:s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Vu{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Vu(ao.fromBase64String(t))}catch(t){throw new ur(hr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Vu(ao.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Uu{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new ur(hr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Dr(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Bu{constructor(t){this._methodName=t}}class ju{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new ur(hr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ur(hr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Tr(this._lat,t._lat)||Tr(this._long,t._long)}}const qu=/^__.*__$/;class $u{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new ic(t,this.data,this.fieldMask,e,this.fieldTransforms):new sc(t,this.data,e,this.fieldTransforms)}}class zu{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new ic(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Hu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ar()}}class Ku{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(t){return new Ku(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Au({path:n,Vu:!1});return s.mu(t),s}fu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Au({path:n,Vu:!1});return s.Eu(),s}gu(t){return this.Au({path:void 0,Vu:!0})}pu(t){return id(t,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Eu(){if(this.path)for(let t=0;t<this.path.length;t++)this.mu(this.path.get(t))}mu(t){if(0===t.length)throw this.pu("Document fields must not be empty");if(Hu(this.du)&&qu.test(t))throw this.pu('Document fields cannot begin and end with "__"')}}class Gu{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Wl(t)}Su(t,e,n,s=!1){return new Ku({du:t,methodName:e,wu:n,path:Dr.emptyPath(),Vu:!1,yu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Qu(t){const e=t._freezeSettings(),n=Wl(t._databaseId);return new Gu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Wu(t,e,n,s,i,r={}){const o=t.Su(r.merge||r.mergeFields?2:0,e,n,i);td("Data must be an object, but it was:",o,s);const a=Ju(s,o);let c,l;if(r.merge)c=new ro(o.fieldMask),l=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=ed(e,s,n);if(!o.contains(i))throw new ur(hr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);rd(t,i)||t.push(i)}c=new ro(t),l=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,l=o.fieldTransforms;return new $u(new Ro(a),c,l)}class Xu extends Bu{_toFieldTransform(t){if(2!==t.du)throw 1===t.du?t.pu(`${this._methodName}() can only appear at the top level of your update data`):t.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Xu}}function Yu(t,e){if(Zu(t=R(t)))return td("Unsupported field value:",e,t),Ju(t,e);if(t instanceof Bu)return function(t,e){if(!Hu(e.du))throw e.pu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.pu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Vu&&4!==e.du)throw e.pu("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=Yu(i,e.gu(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=R(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ma(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Cr.fromDate(t);return{timestampValue:Pc(e.serializer,n)}}if(t instanceof Cr){const n=new Cr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Pc(e.serializer,n)}}if(t instanceof ju)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Vu)return{bytesValue:Fc(e.serializer,t._byteString)};if(t instanceof Du){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.pu(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Bc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.pu(`Unsupported field value: ${Cu(t)}`)}(t,e)}function Ju(t,e){const n={};return Zr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Jr(t,((t,s)=>{const i=Yu(s,e.Ru(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Zu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Cr||t instanceof ju||t instanceof Vu||t instanceof Du||t instanceof Bu)}function td(t,e,n){if(!Zu(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=Cu(n);throw"an object"===s?e.pu(t+" a custom object"):e.pu(t+" "+s)}}function ed(t,e,n){if((e=R(e))instanceof Uu)return e._internalPath;if("string"==typeof e)return sd(t,e);throw id("Field path arguments must be of type string or ",t,!1,void 0,n)}const nd=new RegExp("[~\\*/\\[\\]]");function sd(t,e,n){if(e.search(nd)>=0)throw id(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Uu(...e.split("."))._internalPath}catch(s){throw id(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function id(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${s}`),o&&(c+=` in document ${i}`),c+=")"),new ur(hr.INVALID_ARGUMENT,a+t+c)}function rd(t,e){return t.some((t=>t.isEqual(e)))}class od{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Du(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new ad(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(cd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class ad extends od{data(){return super.data()}}function cd(t,e){return"string"==typeof e?sd(t,e):e instanceof Uu?e._internalPath:e._delegate._internalPath}class ld{convertValue(t,e="none"){switch(wo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ho(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(uo(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw ar()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Jr(t,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new ju(ho(t.latitude),ho(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=po(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(go(t));default:return null}}convertTimestamp(t){const e=lo(t);return new Cr(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Ar.fromString(t);cr(ol(n));const s=new yo(n.get(1),n.get(3)),i=new Nr(n.popFirst(5));return s.isEqual(e)||ir(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class hd{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ud extends od{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new dd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(cd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class dd extends ud{data(t={}){return super.data(t)}}class fd{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new hd(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new dd(this._firestore,this._userDataWriter,n.key,n,new hd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ur(hr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const s=new dd(t._firestore,t._userDataWriter,n.doc.key,n.doc,new hd(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new dd(t._firestore,t._userDataWriter,e.doc.key,e.doc,new hd(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:pd(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function pd(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ar()}}class gd extends ld{constructor(t){super(),this.firestore=t}convertBytes(t){return new Vu(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Du(this.firestore,null,e)}}function md(t){t=xu(t,ku);const e=xu(t.firestore,Mu),n=Pu(e),s=new gd(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new ur(hr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),wu(n,t._query).then((n=>new fd(e,s,t,n)))}function yd(t,e){const n=xu(t.firestore,Mu),s=Ru(t),i=function(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}(t.converter,e);return vd(n,[Wu(Qu(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,Wa.exists(!1))]).then((()=>s))}function vd(t,e){return function(t,e){const n=new dr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=hu(t);try{const t=await function(t,e){const n=lr(t),s=Cr.now(),i=e.reduce(((t,e)=>t.add(e.key)),Na());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=_a(),c=Na();return n.os.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{r=i;const o=[];for(const t of e){const e=ec(t,r.get(t.key).overlayedDocument);null!=e&&o.push(new ic(t.key,e,Oo(e.value.mapValue),Wa.exists(!0)))}return n.mutationQueue.addMutationBatch(t,s,o,e)})).next((e=>{o=e;const s=e.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:Ca(r)})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.Da[t.currentUser.toKey()];s||(s=new to(Tr)),s=s.insert(e,n),t.Da[t.currentUser.toKey()]=s}(s,t.batchId,n),await au(s,t.changes),await vh(s.remoteStore)}catch(t){const e=Nh(t,"Failed to persist write");n.reject(e)}}(await function(t){return yu(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(Pu(t),e)}new WeakMap,function(t,e=!0){tr="10.7.2",yt(new O("firestore",((t,{instanceIdentifier:n,options:s})=>{const i=t.getProvider("app").getImmediate(),r=new Mu(new mr(t.getProvider("auth-internal")),new br(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ur(hr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new yo(t.options.projectId,e)}(i,n),i);return s=Object.assign({useFetchStreams:e},s),r._setSettings(s),r}),"PUBLIC").setMultipleInstances(!0)),Et(Ji,"4.4.1",t),Et(Ji,"4.4.1","esm2017")}();var wd=function(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))};const bd=function(t,e){const n="string"==typeof t?t:"(default)",s=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=dt){const e=pt.get(t);if(!e&&t===dt&&S())return bt();if(!e)throw vt.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:n});if(!s._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=T())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),s]:[e.substring(0,n),s]})("firestore");t&&function(t,e,n,s={}){var i;const r=(t=xu(t,Au))._getSettings(),o=`${e}:${n}`;if("firestore.googleapis.com"!==r.host&&r.host!==o&&rr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},r),{host:o,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=Zi.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[_(JSON.stringify({alg:"none",type:"JWT"})),_(JSON.stringify(r)),""].join(".")}(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new ur(hr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Zi(r)}t._authCredentials=new gr(new fr(e,n))}}(s,...t)}return s}(bt({apiKey:"AIzaSyAS_sGDbQYUNZAoF-ZqZcpjWtLQtBmDvsw",authDomain:"proyecto-dca-1b72d.firebaseapp.com",projectId:"proyecto-dca-1b72d",storageBucket:"proyecto-dca-1b72d.appspot.com",messagingSenderId:"272880735350",appId:"1:272880735350:web:f0dbcec16d1c028a4afb57",measurementId:"G-L13XCXHTB8"})),Ed=t=>wd(void 0,void 0,void 0,(function*(){const e=Ru(bd,"users","e14Adty5xAvKNl0ceGnc");yield function(t,e,n,...s){t=xu(t,Du);const i=xu(t.firestore,Mu),r=Qu(i);let o;return o="string"==typeof(e=R(e))||e instanceof Uu?function(t,e,n,s,i,r){const o=t.Su(1,e,n),a=[ed(e,s,n)],c=[i];if(r.length%2!=0)throw new ur(hr.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)a.push(ed(e,r[t])),c.push(r[t+1]);const l=[],h=Ro.empty();for(let t=a.length-1;t>=0;--t)if(!rd(l,a[t])){const e=a[t];let n=c[t];n=R(n);const s=o.fu(e);if(n instanceof Xu)l.push(e);else{const t=Yu(n,s);null!=t&&(l.push(e),h.set(e,t))}}const u=new ro(l);return new zu(h,u,o.fieldTransforms)}(r,"updateDoc",t._key,e,n,s):function(t,e,n,s){const i=t.Su(1,e,n);td("Data must be an object, but it was:",i,s);const r=[],o=Ro.empty();Jr(s,((t,s)=>{const a=sd(e,t,n);s=R(s);const c=i.fu(a);if(s instanceof Xu)r.push(a);else{const t=Yu(s,c);null!=t&&(r.push(a),o.set(a,t))}}));const a=new ro(r);return new zu(o,a,i.fieldTransforms)}(r,"updateDoc",t._key,e),vd(i,[o.toMutation(t._key,Wa.exists(!0))])}(e,{fav_song:t})})),_d={wave:""};class Td extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),a(this)}connectedCallback(){this.render()}render(){var e;if(this.shadowRoot){u.forEach((t=>{var e;const n=document.createElement("my-header");n.setAttribute(d.logo,t.logo),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)}));const n=this.ownerDocument.createElement("input");n.placeholder="Enter your Wave",n.classList.add("image"),n.addEventListener("change",this.changeWave),this.shadowRoot.appendChild(n);const s=this.ownerDocument.createElement("button");s.innerText="Save",s.classList.add("save"),s.addEventListener("click",this.submitForm.bind(this)),null===(e=this.shadowRoot)||void 0===e||e.appendChild(s),g.forEach((t=>{var e;const n=document.createElement("my-card");console.log(t),n.setAttribute(m.name,t.name),n.setAttribute(m.image,t.image),n.setAttribute(m.unlike,t.unlike),n.setAttribute(m.like,t.like),n.setAttribute(m.cantidadlike,t.cantidadlike),n.setAttribute(m.share,t.share),n.setAttribute(m.cantidadshare,t.cantidadshare),n.setAttribute(m.comentar,t.comentar),n.setAttribute(m.cantidadcomentar,t.cantidadcomentar),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)})),t.forEach((t=>{var e;const n=document.createElement("my-iconos");n.setAttribute(l.iconohome,t.iconohome),n.setAttribute(l.iconoexplore,t.iconoexplore),n.setAttribute(l.iconoprofile,t.iconoprofile),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)}))}}submitForm(){var t,e,n;const s=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".image"),i=s.value;var r;_d.wave=i,console.log(_d),r=_d,wd(void 0,void 0,void 0,(function*(){try{const t=Lu(bd,"waves");yield yd(t,r),console.log("se añadió con éxito")}catch(t){console.error(t)}})),s.value="";const o=document.createElement("p");o.textContent=i,s.nextSibling?null===(e=this.shadowRoot)||void 0===e||e.insertBefore(o,s.nextSibling):null===(n=this.shadowRoot)||void 0===n||n.appendChild(o),this.saveWaveToLocalStorage(i)}saveWaveToLocalStorage(t){const e=JSON.parse(localStorage.getItem("savedWaves")||"[]");e.push(t),localStorage.setItem("savedWaves",JSON.stringify(e))}changeWave(t){_d.wave=t.target.value}}customElements.define("app-dashboard",Td);const Sd=[{id:1,logo:"https://i.pinimg.com/736x/4e/97/d6/4e97d610dfc03d8fde6969d5be6434f4.jpg",log_out:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#1e1e1e" d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"/></svg>'}];var Cd;!function(t){t.uid="uid",t.logo="logo",t.log_out="log_out"}(Cd||(Cd={}));class xd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({uid:null,logo:null,log_out:null})}attributeChangedCallback(t,e,n){t===Cd.uid?this.uid=n?Number(n):void 0:this[t]=n}connectedCallback(){this.render()}render(){var t,e,n;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n    <section class="header">\n\t\t<section class="logo">\n    <img src='${this.logo}'></img>\n\t\t</section>\n\n\t\t<svg class="log_out" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#1e1e1e" d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"/></svg>\n    </section>`);const s=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".logo");null==s||s.addEventListener("click",(()=>{o(c("HOME"))}));const i=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".log_out");null==i||i.addEventListener("click",(()=>{o(c("REGISTER"))}));const r=this.ownerDocument.createElement("style");r.innerHTML=f.A,null===(n=this.shadowRoot)||void 0===n||n.appendChild(r)}}customElements.define("my-headerprofile",xd);const Id=[{id:1,iconohome:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"  viewBox="0 0 576 512">\x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#1E1E1E" d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg>',iconoexplore:'"https://i.pinimg.com/originals/94/67/f5/9467f504e83345d60816f9b87ac84588.jpg"',iconoprofile:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"  viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#ff9f1c" d="M399 384.2C376.9 345.8 335.4 320 288 320H224c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 16a72 72 0 1 0 0-144 72 72 0 1 0 0 144z"/></svg>'}];var Ad,kd=n(831);!function(t){t.profile_image="profile_image",t.username="username",t.fav_song="fav_song",t.name="name",t.followers="followers",t.following="following"}(Ad||(Ad={}));class Dd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({profile_image:null,username:null,fav_song:null,name:null,followers:null,following:null})}attributeChangedCallback(t,e,n){this[t]=n}connectedCallback(){this.render()}render(){var t,e,n,s,i;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n\t\t<section class="todo">\n\t\t<section class="profile">\n    <img class="image" src="${this.profile_image}"></img>\n    <h1>${this.username}</h1>\n\t\t<Button class="edit">Edit picture</Button>\n\n    <button id="ButtonSong">\n\t\t<p class="fav_song"><svg class="pin"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgb(46, 196, 182);transform: ;msFilter:;"><path d="M15 11.586V6h2V4a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v2h2v5.586l-2.707 1.707A.996.996 0 0 0 6 14v2a1 1 0 0 0 1 1h4v3l1 2 1-2v-3h4a1 1 0 0 0 1-1v-2a.996.996 0 0 0-.293-.707L15 11.586z"></path></svg></svg>\n\t\t${this.fav_song}</p>\n    </section>\n\n\t\t<section class="name-following">\n    <p class="name">${this.name}</p>\n\t\t<p class="following">${this.following}</p>\n\t\t</section>\n\n    <p class="followers">${this.followers}</p>\n    <Button class="playlist">Playlists</Button>\n\t\t</section>\n\t\t</section>\n\n\n\t\t<section class="modalContainer" style="display:none;">\n    <form class="waveSong">\n        <span class="close">X</span>\n        <h2>What's your wave song at the moment?</h2>\n        <textarea id="writtenSong" name="wave"></textarea>\n        <span role="button" class="post">Post</span>\n    </form>\n    `);const r=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".modalContainer"),o=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("#ButtonSong"),a=null===(n=this.shadowRoot)||void 0===n?void 0:n.querySelector(".close");(null===(s=this.shadowRoot)||void 0===s?void 0:s.querySelector(".post")).addEventListener("click",(()=>function(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){var t;const e=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("#writtenSong"),n=e.value;Ed(n),e.value="",r.style.display="none",document.body.style.overflow="auto"}))));const c=document.body;c&&(o.addEventListener("click",(()=>{r.style.display="block",c.style.overflow="hidden"})),a.addEventListener("click",(()=>{var t;r.style.display="none",c.style.overflow="auto",window.addEventListener("click",(t=>{t.target==r&&(r.style.display="none",c.style.overflow="auto")})),(null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".post")).addEventListener("click",(t=>{var e;t.preventDefault();const n=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("#writtenSong"),s=n.value;console.log("Entered wave:",s),n.value="",r.style.display="none",c.style.overflow="auto"}))})));const l=this.ownerDocument.createElement("style");l.innerHTML=kd.A,null===(i=this.shadowRoot)||void 0===i||i.appendChild(l)}}customElements.define("my-perfil",Dd);var Nd,Ld=n(471);!function(t){t.artist="artist",t.song_title="song_title",t.image="image",t.top="top"}(Nd||(Nd={}));class Rd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({artist:null,song_title:null,image:null,top:null})}attributeChangedCallback(t,e,n){this[t]=n}connectedCallback(){this.render()}render(){var t;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n\t\t\t<section class = "card">\n\n\t\t\t<p class="top">${this.top}</p>\n\n\t\t\t<section class= "imagen">\n\t\t\t<img src="${this.image}"></img>\n\t\t\t</section>\n\n\t\t\t<section class = "letters">\n\n\t\t\t<section class = "title">\n\t\t\t<p>${this.song_title}</p>\n\t\t\t</section>\n\n\t\t<section class = "artist">\n\t\t<p>${this.artist}</p>\n\t\t</section>\n\n\t\t</section>\n\n\t\t</section>\n    `);const e=this.ownerDocument.createElement("style");e.innerHTML=Ld.A,null===(t=this.shadowRoot)||void 0===t||t.appendChild(e)}}customElements.define("my-songs",Rd);var Od=n(11),Md=function(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))};const Pd={top:"",artist:"",song_title:"",image:""};class Fd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),a(this)}connectedCallback(){return Md(this,void 0,void 0,(function*(){const t=yield wd(void 0,void 0,void 0,(function*(){const t=[];return(yield md(Lu(bd,"users"))).forEach((e=>{t.push(e.data())})),t}));this.render(t)}))}submitForm(){var t;console.log(Pd),t=Pd,wd(void 0,void 0,void 0,(function*(){try{const e=Lu(bd,"playlist");yield yd(e,t),console.log("se añadió con éxito")}catch(t){console.error(t)}}))}changeArtist(t){Pd.artist=t.target.value}changeTitle(t){Pd.song_title=t.target.value}changeImage(t){Pd.image=t.target.value}render(t){return Md(this,void 0,void 0,(function*(){var e,n,s,i;this.shadowRoot&&Sd.forEach((t=>{var e;const n=document.createElement("my-headerprofile");n.setAttribute(Cd.logo,t.logo),n.setAttribute(Cd.log_out,t.log_out),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)})),t.forEach((t=>{var e;const n=document.createElement("my-perfil");n.setAttribute(Ad.profile_image,t.profile_image),n.setAttribute(Ad.username,t.username),n.setAttribute(Ad.name,t.name),n.setAttribute(Ad.fav_song,t.fav_song),n.setAttribute(Ad.followers,t.followers),n.setAttribute(Ad.following,t.following),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)}));const r=this.ownerDocument.createElement("h1");r.textContent="Add your own song",r.classList.add("h1Add"),null===(e=this.shadowRoot)||void 0===e||e.appendChild(r);const o=this.ownerDocument.createElement("section");o.classList.add("create-song");const a=this.ownerDocument.createElement("input");a.placeholder="Add an artist",a.classList.add("artist"),a.addEventListener("change",this.changeArtist),o.appendChild(a);const c=this.ownerDocument.createElement("input");c.placeholder="Add the song title",c.classList.add("title"),c.addEventListener("change",this.changeTitle),o.appendChild(c);const h=this.ownerDocument.createElement("input");h.placeholder="Add the album cover",h.classList.add("image"),h.addEventListener("change",this.changeImage),o.appendChild(h),null===(n=this.shadowRoot)||void 0===n||n.appendChild(o);const u=this.ownerDocument.createElement("button");u.innerText="Save",u.classList.add("save"),u.addEventListener("click",this.submitForm),null===(s=this.shadowRoot)||void 0===s||s.appendChild(u),(yield wd(void 0,void 0,void 0,(function*(){const t=yield md(Lu(bd,"playlist")),e=[];return t.forEach((t=>{const n=t.data();e.push(Object.assign({id:t.id},n))})),e}))).forEach((t=>{var e;const n=this.ownerDocument.createElement("my-songs");n.setAttribute(Nd.top,"●"),n.setAttribute(Nd.image,t.image),n.setAttribute(Nd.artist,t.artist),n.setAttribute(Nd.song_title,t.song_title),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)})),Id.forEach((t=>{var e;const n=document.createElement("my-iconos");n.setAttribute(l.iconohome,t.iconohome),n.setAttribute(l.iconoexplore,t.iconoexplore),n.setAttribute(l.iconoprofile,t.iconoprofile),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)}));const d=this.ownerDocument.createElement("style");d.innerHTML=Od.A,null===(i=this.shadowRoot)||void 0===i||i.appendChild(d)}))}}customElements.define("app-perfil",Fd);var Vd,Ud=n(499);!function(t){t.uid="uid",t.name="name",t.photo="photo",t.profile="profile",t.song="song"}(Vd||(Vd={}));class Bd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({uid:null,photo:null,name:null,profile:null,song:null})}attributeChangedCallback(t,e,n){t===Vd.uid?this.uid=n?Number(n):void 0:this[t]=n}connectedCallback(){this.render()}render(){var t;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n\n\t\t<section class="card" style="background-image: url('${this.photo}');background-position-x: center;background-size: cover;">\n\t\t<section class="todo">\n\t\t<section class= "image">\n\t\t<img src='${this.profile}'></img>\n    <p>${this.name}</p>\n\t\t</section>\n\t\t<section class="song">\n    <h3>${this.song}</h3>\n\t\t</section>\n\t\t</section>\n\t\t</section>\n\t\t`);const e=this.ownerDocument.createElement("style");e.innerHTML=Ud.A,null===(t=this.shadowRoot)||void 0===t||t.appendChild(e)}}customElements.define("my-friend",Bd);const jd=[{id:1,iconohome:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"  viewBox="0 0 576 512">\x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#1E1E1E" d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg>',iconoexplore:'\t"https://i.pinimg.com/originals/33/ff/00/33ff00839226a94f68b571016bc6d99c.jpg"',iconoprofile:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgb(32, 32, 32);transform: ;msFilter:;"><path d="M12 2C6.579 2 2 6.579 2 12s4.579 10 10 10 10-4.579 10-10S17.421 2 12 2zm0 5c1.727 0 3 1.272 3 3s-1.273 3-3 3c-1.726 0-3-1.272-3-3s1.274-3 3-3zm-5.106 9.772c.897-1.32 2.393-2.2 4.106-2.2h2c1.714 0 3.209.88 4.106 2.2C15.828 18.14 14.015 19 12 19s-3.828-.86-5.106-2.228z"></path></svg>'}];var qd=n(628);class $d extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),a(this)}connectedCallback(){return function(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){const t=yield wd(void 0,void 0,void 0,(function*(){const t=[];return(yield md(Lu(bd,"Friends-playlist"))).forEach((e=>{t.push(e.data())})),t})),e=yield wd(void 0,void 0,void 0,(function*(){const t=[];return(yield md(Lu(bd,"Songs"))).forEach((e=>{t.push(e.data())})),t}));console.log(t,e),this.render(t,e)}))}render(t,e){var n,s,i,r;this.shadowRoot&&u.forEach((t=>{var e;const n=document.createElement("my-header");n.setAttribute(d.logo,t.logo),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)})),jd.forEach((t=>{var e;const n=document.createElement("my-iconos");n.setAttribute(l.iconohome,t.iconohome),n.setAttribute(l.iconoexplore,t.iconoexplore),n.setAttribute(l.iconoprofile,t.iconoprofile),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)}));const o=this.ownerDocument.createElement("h1");o.textContent="On trending",null===(n=this.shadowRoot)||void 0===n||n.appendChild(o),e.forEach(((t,e)=>{var n;const s=document.createElement("my-songs");s.setAttribute(Nd.top,t.top),s.setAttribute(Nd.song_title,t.song_title),s.setAttribute(Nd.artist,t.artist),s.setAttribute(Nd.image,t.image),s.setAttribute("data-index",(e+1).toString()),null===(n=this.shadowRoot)||void 0===n||n.appendChild(s)}));const a=this.ownerDocument.createElement("h1");a.textContent="My friends playlist",null===(s=this.shadowRoot)||void 0===s||s.appendChild(a);const c=this.ownerDocument.createElement("section");c.classList.add("playlists"),t.forEach((t=>{const e=document.createElement("my-friend");console.log(t),e.setAttribute(Vd.name,t.name),e.setAttribute(Vd.profile,t.profile),e.setAttribute(Vd.photo,t.photo),e.setAttribute(Vd.song,t.song),c.appendChild(e)})),null===(i=this.shadowRoot)||void 0===i||i.appendChild(c);const h=this.ownerDocument.createElement("style");h.innerHTML=qd.A,null===(r=this.shadowRoot)||void 0===r||r.appendChild(h)}}customElements.define("app-explore",$d);var zd,Hd=n(835);!function(t){t.logo="logo",t.google="google",t.facebook="facebook",t.outlook="outlook"}(zd||(zd={}));class Kd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({logo:null,google:null,facebook:null,outlook:null})}attributeChangedCallback(t,e,n){this[t]=n}connectedCallback(){this.render()}render(){var t,e,n;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n      <section class="todo">\n\n      <svg class="svg" xmlns="http://www.w3.org/2000/svg" height="35" width="35" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#2ec4b6" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"/></svg>\n\n      <img class="logo" src="${this.logo}"></img>\n\n      <section class="info">\n\t\t\t<h1 class="text_create">Create your account</h1>\n\n      <section class="inputs">\n\t\t\t<form>\n\t\t\t<input type="Email" placeholder="Email"></input>\n\t\t\t<input type="Username" placeholder="Username"></input>\n\t\t\t<input type="Password" placeholder="Password"></input>\n      </section>\n\t\t\t<button type="submit">Sign Up</button>\n\t\t\t</form>\n      </section>\n\t\t\t<p class="text">Or sign up with</p>\n\n      <section id="apps">\n      <img class="google" src="${this.google}"></img>\n      <img class="facebook" src="${this.facebook}"></img>\n      <img class="outlook" src="${this.outlook}"></img>\n      </section>\n      <section class="already_have">\n      <p class="text">Already have an account?</p>\n      <p class="signup_btn">Log In</p>\n      </section>\n      </section>\n    `);const s=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".svg");null==s||s.addEventListener("click",(()=>{o(c("PROFILE"))}));const i=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".signup_btn");null==i||i.addEventListener("click",(()=>{o(c("LOGIN"))}));const r=this.ownerDocument.createElement("style");r.innerHTML=Hd.A,null===(n=this.shadowRoot)||void 0===n||n.appendChild(r)}}customElements.define("my-register",Kd);const Gd=[{id:1,logo:"https://i.pinimg.com/736x/4e/97/d6/4e97d610dfc03d8fde6969d5be6434f4.jpg",google:"https://cdn1.iconfinder.com/data/icons/google-s-logo/150/Google_Icons-09-512.png",facebook:"https://upload.wikimedia.org/wikipedia/commons/6/6c/Facebook_Logo_2023.png",outlook:"https://seeklogo.com/images/M/microsoft-outlook-logo-188AB32C94-seeklogo.com.png"}];class Qd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),a(this)}connectedCallback(){this.render()}render(){this.shadowRoot&&Gd.forEach((t=>{var e;const n=document.createElement("my-register");n.setAttribute(zd.logo,t.logo),n.setAttribute(zd.google,t.google),n.setAttribute(zd.facebook,t.facebook),n.setAttribute(zd.outlook,t.outlook),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)}))}}var Wd;customElements.define("app-register",Qd),function(t){t.logo="logo",t.google="google",t.facebook="facebook",t.outlook="outlook"}(Wd||(Wd={}));class Xd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.keys({logo:null,google:null,facebook:null,outlook:null})}attributeChangedCallback(t,e,n){this[t]=n}connectedCallback(){this.render()}render(){var t,e,n;this.shadowRoot&&(this.shadowRoot.innerHTML=`\n      <section class="todo">\n\n      <svg class="svg" xmlns="http://www.w3.org/2000/svg" height="35" width="35" viewBox="0 0 320 512">\x3c!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--\x3e<path fill="#2ec4b6" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"/></svg>\n\n      <img class="logo" src="${this.logo}"></img>\n\n      <section class="info">\n\t\t\t<h1 class="text_create">Log in to your account</h1>\n\n      <section class="inputs">\n\t\t\t<form>\n\t\t\t<input type="Email" placeholder="Email or Username"></input>\n\t\t\t<input type="Password" placeholder="Password"></input>\n      </section>\n\t\t\t<button type="submit">Sign In</button>\n\t\t\t</form>\n      </section>\n\t\t\t<p class="text">Or sign in with</p>\n\n      <section id="apps">\n      <img class="google" src="${this.google}"></img>\n      <img class="facebook" src="${this.facebook}"></img>\n      <img class="outlook" src="${this.outlook}"></img>\n      </section>\n      <section class="already_have">\n      <p class="text">Don't have an account?</p>\n      <p class="signup_btn" >Sign Up</p>\n      </section>\n      </section>\n    `);const s=null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector(".svg");null==s||s.addEventListener("click",(()=>{o(c("PROFILE"))}));const i=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector(".signup_btn");null==i||i.addEventListener("click",(()=>{o(c("REGISTER"))}));const r=this.ownerDocument.createElement("style");r.innerHTML=Hd.A,null===(n=this.shadowRoot)||void 0===n||n.appendChild(r)}}customElements.define("my-login",Xd);class Yd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),a(this)}connectedCallback(){this.render()}render(){this.shadowRoot&&Gd.forEach((t=>{var e;const n=document.createElement("my-login");n.setAttribute(Wd.logo,t.logo),n.setAttribute(Wd.google,t.google),n.setAttribute(Wd.facebook,t.facebook),n.setAttribute(Wd.outlook,t.outlook),null===(e=this.shadowRoot)||void 0===e||e.appendChild(n)}))}}customElements.define("app-login",Yd);class Jd extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),a(this)}connectedCallback(){this.render()}render(){var t,e,n,s,r;switch(this.shadowRoot&&(this.shadowRoot.innerHTML=""),i.screen){case"HOME":const i=this.ownerDocument.createElement("app-dashboard");null===(t=this.shadowRoot)||void 0===t||t.appendChild(i);break;case"EXPLORE":const o=this.ownerDocument.createElement("app-explore");null===(e=this.shadowRoot)||void 0===e||e.appendChild(o);break;case"PROFILE":const a=this.ownerDocument.createElement("app-perfil");null===(n=this.shadowRoot)||void 0===n||n.appendChild(a);break;case"REGISTER":const c=this.ownerDocument.createElement("app-register");null===(s=this.shadowRoot)||void 0===s||s.appendChild(c);break;case"LOGIN":const l=this.ownerDocument.createElement("app-login");null===(r=this.shadowRoot)||void 0===r||r.appendChild(l)}}}customElements.define("app-container",Jd)})()})();